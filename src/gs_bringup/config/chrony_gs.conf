# chrony configuration for GS (LAN NTP server)
# GS: 192.168.68.50
# LAN: 192.168.68.0/24
#
# 使用方法:
#   sudo cp chrony_gs.conf /etc/chrony/chrony.conf
#   sudo systemctl restart chrony
#   chronyc sources -v
#   chronyc tracking

# --- Upstream (Internet) time sources ---
# Keep at least 2-4 pools for robustness
pool ntp.aliyun.com iburst
pool ntp.tencent.com iburst
pool time.cloudflare.com iburst
pool pool.ntp.org iburst

# --- Local settings ---
driftfile /var/lib/chrony/chrony.drift

# Allow stepping the clock in the first 3 updates if offset is large
makestep 1.0 3

# Sync the system clock to RTC
rtcsync

# --- Serve time to LAN clients ---
allow 192.168.68.0/24

# If GS temporarily loses Internet, still serve its local time to LAN
# (comment out if you want to STOP serving when upstream is down)
local stratum 10

# Optional: reduce noise, keep logs standard
logdir /var/log/chrony
