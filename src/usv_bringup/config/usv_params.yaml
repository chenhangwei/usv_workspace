# =============================================================================
# USVç³»ç»Ÿå‚æ•°é…ç½®æ–‡ä»¶
# è¯¥æ–‡ä»¶å®šä¹‰äº†USVç³»ç»Ÿä¸­å„èŠ‚ç‚¹çš„å‚æ•°é…ç½®
# =============================================================================

# =============================================================================
# é£æ§é€šä¿¡æ¨¡å—å‚æ•° (MAVROS)
# 
# å¤š USV æœºè½½è®¡ç®—æœºçš„ system_id é…ç½®è¯´æ˜:
# 
# åœºæ™¯: å¤šå°ç‹¬ç«‹ USV,æ¯å°æœ‰è‡ªå·±çš„æœºè½½è®¡ç®—æœº(gauss02/gauss03)å’Œé£æ§
# 
# system_id è®¾ç½®åŸåˆ™:
# 1. æ¯ä¸ªæœºè½½è®¡ç®—æœºä½¿ç”¨å”¯ä¸€çš„ system_id (æ¨è: usv_02ç”¨2, usv_03ç”¨3)
# 2. æ‰€æœ‰é£æ§ç»Ÿä¸€ä½¿ç”¨ system_id=1 (ArduPilot æ ‡å‡†)
# 3. åœ°é¢ç«™ä½¿ç”¨ system_id=255 (GCS æ ‡å‡†)
# 
# MAVLink è·¯ç”±å·¥ä½œåŸç†:
# - é£æ§ä¼šè®°ä½"ä»å“ªä¸ªä¸²å£æ”¶åˆ°å“ªä¸ª sysid çš„æ¶ˆæ¯"
# - å½“æ”¶åˆ°ç›®æ ‡ä¸ºæŸ sysid çš„æ¶ˆæ¯æ—¶,é£æ§ä¼šè½¬å‘åˆ°å¯¹åº”ä¸²å£
# - è¿™æ ·åœ°é¢ç«™(sysid=255)å¯ä»¥é€šè¿‡é£æ§ä¸æœºè½½ç”µè„‘(sysid=2/3)é€šä¿¡
# 
# âš ï¸ å…³é”®: target_system_id å¿…é¡»è®¾ä¸º 1 (é£æ§ID),å¦åˆ™æ— æ³•æ¥æ”¶é£æ§å¿ƒè·³!
# =============================================================================
mavros:
  ros__parameters:
    # ==================== MAVLink èº«ä»½é…ç½® ====================
    # æ³¨æ„: system_id/target_system_id ç­‰å‚æ•°å·²ç§»è‡³ launch æ–‡ä»¶ä¸­é…ç½®
    # è¯·åœ¨ usv_launch.py ä¸­ä¿®æ”¹ target_system_id:
    # - usv_02: target_system_id = 2 (åŒ¹é…é£æ§ SYSID_THISMAV=2)
    # - usv_03: target_system_id = 3 (åŒ¹é…é£æ§ SYSID_THISMAV=3)
    
    # ==================== æ’ä»¶é…ç½®ï¼ˆå·²ç§»è‡³ launch æ–‡ä»¶ï¼‰====================
    # âš ï¸ æ’ä»¶é»‘åå•é…ç½®å·²ç§»è‡³ usv_launch.pyï¼Œæ­¤å¤„é…ç½®å·²å¤±æ•ˆ
    # è¯·åœ¨ launch æ–‡ä»¶ä¸­ä¿®æ”¹ plugin_blacklist å‚æ•°
    # 
    # ä¿ç•™çš„æ ¸å¿ƒæ’ä»¶ï¼ˆ15ä¸ªï¼‰ï¼š
    # sys_status, sys_time, command, local_position, global_position,
    # home_position, gps_status, battery, imu, rc_io, setpoint_raw,
    # waypoint, rallypoint, geofence, vfr_hud
    
    # ==================== æ€§èƒ½ä¼˜åŒ–å‚æ•°ï¼ˆå·²ç§»è‡³ launch æ–‡ä»¶ï¼‰====================
    # ä»¥ä¸‹å‚æ•°å·²åœ¨ launch æ–‡ä»¶ä¸­é…ç½®ï¼Œæ­¤å¤„ä¿ç•™ä»…ä½œä¸ºæ–‡æ¡£å‚è€ƒ
    # sys.disable_diag: true
    # mission.pull_after_gcs: false
    # waypoint.pull_after_gcs: false
    # rallypoint.pull_after_gcs: false
    # geofence.pull_after_gcs: false
    
    # è¿æ¥å‚æ•°ï¼ˆä¿ç•™ä½œä¸ºé»˜è®¤å€¼ï¼‰
    conn:
      timeout: 10.0                         # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
      heartbeat_mav_type: 6                 # MAV_TYPE_SURFACE_BOAT
      heartbeat_rate: 1.0                   # å¿ƒè·³é¢‘ç‡ï¼ˆHzï¼‰
      
    # è§†è§‰å®šä½é…ç½®
    vision_pose:
      enable: false                         # ç¦ç”¨è§†è§‰å®šä½

# =============================================================================
# é€šä¿¡ä¸çŠ¶æ€ç®¡ç†æ¨¡å—å‚æ•°
# =============================================================================
/**/usv_status_node:
  ros__parameters:
    # ç”µæ± ç”µå‹èŒƒå›´é…ç½®ï¼ˆåŸºäºå®é™…ç”µæ± ç‰¹æ€§ï¼‰
    battery_voltage_full: 12.6              # æ»¡ç”µç”µå‹ï¼ˆVï¼‰- ç”µé‡æ˜¾ç¤º100%
    battery_voltage_empty: 10.8             # ç©ºç”µç”µå‹ï¼ˆVï¼‰- ç”µé‡æ˜¾ç¤º0%ï¼Œéœ€è¦å……ç”µ

# NavigateToPoint è¯é¢˜ç‰ˆæœ¬èŠ‚ç‚¹å‚æ•°ï¼ˆlaunch å®é™…å¯åŠ¨çš„èŠ‚ç‚¹åä¸º navigate_to_point_nodeï¼‰
/**/navigate_to_point_node:
  ros__parameters:
    nav_arrival_threshold: 0.8              # æœ€ç»ˆåˆ°è¾¾ç›®æ ‡ç‚¹çš„è·ç¦»é˜ˆå€¼ï¼ˆç±³ï¼‰- ä¸ velocity_controller ä¸€è‡´
    nav_switch_threshold: 2.0               # å¹³æ»‘å¯¼èˆªæ—¶åˆ‡æ¢ä¸‹ä¸€ä¸ªèˆªç‚¹çš„è·ç¦»é˜ˆå€¼ï¼ˆç±³ï¼‰
    nav_smooth_navigation: true             # æ˜¯å¦å¯ç”¨å¹³æ»‘å¯¼èˆªæ¨¡å¼ï¼ˆè¿ç»­è¿½è¸ªä¸åœé¡¿ï¼‰
    nav_feedback_period: 0.2                # åé¦ˆå‘å¸ƒå‘¨æœŸï¼ˆç§’ï¼‰
    distance_mode: '2d'                     # è·ç¦»è®¡ç®—æ¨¡å¼ï¼š'2d'ï¼ˆä»…XYå¹³é¢ï¼‰æˆ– '3d'ï¼ˆåŒ…å«Zè½´ï¼‰
    waypoint_queue_size: 10                 # èˆªç‚¹é˜Ÿåˆ—å¤§å°ï¼ˆæ”¯æŒé¢„å‘é€ï¼‰
    idle_timeout_sec: 30.0                  # ç©ºé—²ä¿æŠ¤è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰- é˜Ÿåˆ—ç©ºä¸”æ— æ–°èˆªç‚¹æ—¶å‘Šè­¦
    idle_protection_enabled: true           # æ˜¯å¦å¯ç”¨ç©ºé—²ä¿æŠ¤

# Auto Set Home å‚æ•°ï¼ˆå…³é”®ï¼šå»¶é•¿ GPS åˆå§‹åŒ–æ—¶é—´ï¼Œé¿å… z åæ ‡è¯¯å·®ï¼‰
/**/auto_set_home_node:
  ros__parameters:
    set_delay_sec: 10.0                     # GPS é«˜åº¦æ”¶æ•›ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå»ºè®® 8-15 ç§’
    use_current_gps: true                   # ä½¿ç”¨å½“å‰ GPS ä½ç½®ä½œä¸º Home ç‚¹

# =============================================================================
# GPS åæ ‡è½¬æ¢æ¨¡å—å‚æ•°ï¼ˆç»Ÿä¸€çš„ GPS åŸç‚¹é…ç½®ï¼‰
# 
# âš ï¸ é‡è¦è¯´æ˜ï¼š
# æ‰€æœ‰ USV ä½¿ç”¨ç»Ÿä¸€çš„ GPS åŸç‚¹ï¼ˆA0 åŸºç«™ï¼‰è¿›è¡Œåæ ‡è½¬æ¢
# - gps_to_local_node: å°†é£æ§çš„ GPS ä½ç½®è½¬æ¢ä¸ºæœ¬åœ° XYZ åæ ‡
# - coord_transform_node: å°†åœ°é¢ç«™çš„ XYZ ç›®æ ‡ç‚¹è½¬æ¢ä¸º GPS åæ ‡
# 
# GPS åŸç‚¹ï¼ˆA0 åŸºç«™ï¼‰ï¼š22.5180977Â°N, 113.9007239Â°E, -5.17m
# =============================================================================

/**/gps_to_local_node:
  ros__parameters:
    gps_origin_lat: 22.5180977              # åŒ—çº¬ï¼ˆåº¦ï¼‰
    gps_origin_lon: 113.9007239             # ä¸œç»ï¼ˆåº¦ï¼‰
    gps_origin_alt: 0.0                     # æµ·æ‹”ï¼ˆç±³ï¼ŒA0 åŸºç«™å®æµ‹å€¼ï¼‰
    publish_rate: 10.0                      # å‘å¸ƒé¢‘ç‡ï¼ˆHzï¼‰ï¼Œæ¨è 10-20 Hz
    enable_gps_to_local: true               # å¯ç”¨ GPSâ†’æœ¬åœ°åæ ‡è½¬æ¢
    # UWB/ä¼ªå«æ˜Ÿåæ ‡ç³»åç§»è§’ï¼ˆåº¦ï¼‰
    # å®šä¹‰ï¼šUWB Xè½´ ä¸ åœ°ç£ä¸œ çš„å¤¹è§’ï¼ˆé€†æ—¶é’ˆä¸ºæ­£ï¼‰
    # ä¾‹å¦‚ï¼šå¦‚æœ UWB Xè½´ æŒ‡å‘åœ°ç£åŒ—åä¸œ30Â°ï¼Œåˆ™è®¾ç½®ä¸º 60Â°
    # è®¾ç½®ä¸º 0 è¡¨ç¤º UWB Xè½´ ä¸åœ°ç£ä¸œå¯¹é½ï¼ˆæ ‡å‡† ENUï¼‰
    coordinate_yaw_offset_deg: 0.0

/**/coord_transform_node:
  ros__parameters:
    gps_origin_lat: 22.5180977              # åŒ—çº¬ï¼ˆåº¦ï¼‰
    gps_origin_lon: 113.9007239             # ä¸œç»ï¼ˆåº¦ï¼‰
    gps_origin_alt: 0.0                     # æµ·æ‹”ï¼ˆç±³ï¼ŒA0 åŸºç«™å®æµ‹å€¼ï¼‰
    enable_coord_transform: true            # å¯ç”¨ XYZâ†’GPS åæ ‡è½¬æ¢ï¼ˆæ¥æ”¶åœ°é¢ç«™+é¿éšœç›®æ ‡ç‚¹ï¼‰
    use_global_position_target: true        # true=GlobalPositionTarget (æ¨è), false=GeoPoseStamped

# =============================================================================
# æ§åˆ¶æ¨¡å—å‚æ•°
# =============================================================================
/**/usv_avoidance_node:
  ros__parameters:
    # é¿éšœè·ç¦»å‚æ•°
    in_distance_value: 1.0                  # é¿éšœè§¦å‘è·ç¦»ï¼ˆç±³ï¼‰

/**/usv_command_node:
  ros__parameters:
    # æ”¯æŒçš„é£è¡Œæ¨¡å¼åˆ—è¡¨
    supported_modes: ['GUIDED', 'MANUAL', 'AUTO', 'HOLD', 'ARCO', 'STEERING']
    # æœåŠ¡è¶…æ—¶æ—¶é—´
    service_timeout_sec: 5.0                # æœåŠ¡ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    # è§£é”å‘½ä»¤è¶…æ—¶æ—¶é—´
    arming_command_timeout_sec: 10.0        # è§£é”å‘½ä»¤è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

/**/usv_control_node:
  ros__parameters:
    publish_rate: 20.0                      # ç›®æ ‡ç‚¹å‘å¸ƒé¢‘ç‡ï¼ˆHzï¼‰
    frame_id: 'map'                         # åæ ‡ç³»ID
    coordinate_frame: 8                     # FRAME_LOCAL_NED = 8
    enable_local_control: false             # æ˜¯å¦å¯ç”¨å±€éƒ¨æ§åˆ¶ï¼ˆfalse=ä½¿ç”¨coord_transform_nodeçš„å…¨å±€GPSæ¨¡å¼ï¼‰
    # æ§åˆ¶æ¨¡å¼: 'position' (GPSä½ç½®æ¨¡å¼) æˆ– 'velocity' (é€Ÿåº¦æ¨¡å¼ï¼Œç”±velocity_controller_nodeå¤„ç†)
    # é€Ÿåº¦æ¨¡å¼å¯å½»åº•è§£å†³èˆªç‚¹é™„è¿‘å‡é€Ÿé—®é¢˜
    control_mode: 'velocity'                # ğŸ”§ å·²åˆ‡æ¢ä¸ºé€Ÿåº¦æ¨¡å¼ï¼Œä½¿ç”¨ velocity_controller_node

# =============================================================================
# é€Ÿåº¦æ§åˆ¶å™¨å‚æ•° (Pure Pursuit + Stanley æ··åˆæ§åˆ¶)
# 
# ä½¿ç”¨è¯´æ˜:
# 1. å°† usv_control_node.control_mode è®¾ç½®ä¸º 'velocity' å¯ç”¨é€Ÿåº¦æ¨¡å¼
# 2. å¯åŠ¨ velocity_controller_node èŠ‚ç‚¹
# 3. é€Ÿåº¦æ¨¡å¼ä¸‹ï¼Œå¯¼èˆªç›®æ ‡ä»å‘é€åˆ° set_usv_nav_goalï¼Œä½†ç”± velocity_controller_node å¤„ç†
# 
# ä¼˜åŠ¿:
# - å½»åº•è§£å†³èˆªç‚¹é™„è¿‘å‡é€Ÿé—®é¢˜
# - æ›´ç²¾ç¡®çš„è·¯å¾„è·Ÿè¸ª
# - å¯è°ƒèŠ‚çš„æ§åˆ¶å‚æ•°
# =============================================================================
/**/velocity_controller_node:
  ros__parameters:
    # æ§åˆ¶æ¨¡å¼ (å¿…é¡»ä¸ usv_control_node.control_mode ä¸€è‡´)
    control_mode: 'velocity'                # 'position' æˆ– 'velocity'
    
    # æ§åˆ¶å™¨ç±»å‹
    # - 'pure_pursuit': çº¯è¿½è¸ªç®—æ³•ï¼Œè¿œè·ç¦»å¿«é€Ÿæ”¶æ•›
    # - 'stanley': Stanleyæ§åˆ¶å™¨ï¼Œè¿‘è·ç¦»ç²¾ç¡®è·Ÿè¸ª
    # - 'hybrid': æ··åˆæ§åˆ¶ï¼ˆæ¨èï¼‰ï¼Œè‡ªåŠ¨åˆ‡æ¢
    controller_type: 'hybrid'
    
    # ==================== Pure Pursuit å‚æ•° ====================
    lookahead_distance: 2.5                 # å‰è§†è·ç¦»ï¼ˆç±³ï¼‰- ç•¥å¢å¤§æé«˜ç¨³å®šæ€§
    min_lookahead: 1.2                      # æœ€å°å‰è§†è·ç¦»ï¼ˆç±³ï¼‰- æé«˜é¿å…è¿‘è·ç¦»æŒ¯è¡
    max_lookahead: 6.0                      # æœ€å¤§å‰è§†è·ç¦»ï¼ˆç±³ï¼‰
    lookahead_gain: 0.6                     # å‰è§†è·ç¦»å¢ç›Š (L = gain * v + min)
    
    # ==================== Stanley å‚æ•° ====================
    stanley_gain: 2.0                       # Stanley å¢ç›Š kï¼ˆç•¥é™ä½å‡å°‘è¿‡å†²ï¼‰
    stanley_softening: 0.15                 # è½¯åŒ–ç³»æ•°ï¼Œæé«˜ä½é€Ÿç¨³å®šæ€§
    
    # ==================== æ··åˆæ§åˆ¶å‚æ•° ====================
    hybrid_switch_distance: 2.5             # æ··åˆæ§åˆ¶åˆ‡æ¢è·ç¦»é˜ˆå€¼ï¼ˆç±³ï¼‰- ç•¥å¢å¤§
    
    # ==================== é€Ÿåº¦å‚æ•° ====================
    cruise_speed: 0.4                       # å·¡èˆªé€Ÿåº¦ï¼ˆm/sï¼‰- ç•¥é™ä½æé«˜ç²¾åº¦
    max_angular_velocity: 0.4               # æœ€å¤§è§’é€Ÿåº¦ï¼ˆrad/sï¼‰- ç•¥é™ä½å‡å°‘æ€¥è½¬
    min_speed: 0.05                         # æœ€å°é€Ÿåº¦ï¼ˆm/sï¼‰
    
    # ==================== åˆ°è¾¾åˆ¤æ–­ ====================
    # æ³¨æ„: goal_tolerance åº”ä¸ navigate_to_point_node.nav_arrival_threshold ä¸€è‡´
    goal_tolerance: 0.8                     # æœ€ç»ˆèˆªç‚¹åˆ°è¾¾é˜ˆå€¼ï¼ˆç±³ï¼‰
    switch_tolerance: 2.0                   # ä¸­é—´èˆªç‚¹åˆ‡æ¢é˜ˆå€¼ï¼ˆç±³ï¼‰
    
    # ==================== æ§åˆ¶å‚æ•° ====================
    control_rate: 20.0                      # æ§åˆ¶é¢‘ç‡ï¼ˆHzï¼‰
    angular_velocity_filter: 0.4            # è§’é€Ÿåº¦æ»¤æ³¢åŸºç¡€ç³»æ•°ï¼ˆè‡ªé€‚åº”èŒƒå›´ 0.3-0.7ï¼‰
    
    # ==================== å®‰å…¨å‚æ•° ====================
    require_guided_mode: true               # æ˜¯å¦éœ€è¦GUIDEDæ¨¡å¼
    require_armed: true                     # æ˜¯å¦éœ€è¦è§£é”
    
    # ==================== L1é£æ ¼èˆªå‘ä¼°è®¡å‚æ•° ====================
    # ä½¿ç”¨é£æ§EKFé€Ÿåº¦å‘é‡ä»£æ›¿ç£åŠ›è®¡ï¼Œå®Œå…¨é¿å…åæ ‡ç³»åç§»é—®é¢˜
    use_velocity_based_heading: true        # å¯ç”¨é€Ÿåº¦æ–¹å‘èˆªå‘ä¼°è®¡ï¼ˆæ¨èï¼‰
    min_speed_for_velocity_heading: 0.15    # ä½¿ç”¨é€Ÿåº¦èˆªå‘çš„æœ€å°é€Ÿåº¦ï¼ˆm/sï¼‰
                                            # ä½äºæ­¤é€Ÿåº¦æ—¶ä¿æŒæœ€åæœ‰æ•ˆèˆªå‘

# =============================================================================
# ä¼ æ„Ÿå™¨é©±åŠ¨æ¨¡å—å‚æ•°
# =============================================================================
/**/usv_uwb_node:
  ros__parameters:
    dummy_param: true                       # å ä½å‚æ•°

# =============================================================================
# è¾…åŠ©åŠŸèƒ½æ¨¡å—å‚æ•°
# =============================================================================
/**/usv_head_action_node:
  ros__parameters:
    # é»˜è®¤ä¸ºæ— ç¡¬ä»¶æ¨¡å¼ï¼Œé¿å…åœ¨æ—  I2C/PCA9685 ç¯å¢ƒå´©æºƒ
    enable_head_actuator: true             # è®¾ç½®ä¸º true ä»¥å¯ç”¨å®é™…ç¡¬ä»¶æ§åˆ¶

/**/usv_fan_node:
  ros__parameters:
    # é£æ‰‡æ§åˆ¶å¼•è„šé…ç½®
    fan_pin: 17                             # BCMç¼–å·ï¼ŒGPIO17
    gpio_chip: gpiochip4                    # GPIOèŠ¯ç‰‡åç§°
    # æ¸©åº¦é˜ˆå€¼é…ç½®ï¼ˆå•ä½ï¼šæ¯«æ‘„æ°åº¦ï¼‰
    temp_threshold_on: 50000                # é£æ‰‡å¼€å¯æ¸©åº¦é˜ˆå€¼ 50Â°C
    temp_threshold_off: 45000               # é£æ‰‡å…³é—­æ¸©åº¦é˜ˆå€¼ 45Â°C

/**/usv_led_node:
  ros__parameters:
    # LEDæ§åˆ¶ä¸²å£é…ç½®
    port: /dev/ttyUSB0                      # ä¸²å£è®¾å¤‡è·¯å¾„
    baudrate: 115200                        # æ³¢ç‰¹ç‡
    # LEDæ•ˆæœé…ç½®
    color_list: [255, 0, 0, 255, 127, 0, 255, 255, 0, 0, 255, 0, 0, 255, 255, 0, 0, 255, 139, 0, 255]  # é¢œè‰²åˆ—è¡¨ [R,G,B,R,G,B,...]
    timer_period_high: 0.03                 # é«˜é¢‘å®šæ—¶å™¨å‘¨æœŸï¼ˆç§’ï¼‰
    timer_period_low: 0.5                   # ä½é¢‘å®šæ—¶å™¨å‘¨æœŸï¼ˆç§’ï¼‰
    transition_duration: 3.0                # é¢œè‰²æ¸å˜æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
    hold_duration: 10.0                     # é¢œè‰²åœç•™æ—¶é—´ï¼ˆç§’ï¼‰
    breath_step: 6                          # å‘¼å¸ç¯æ­¥è¿›å€¼

/**/usv_sound_node:
  ros__parameters:
    # å£°éŸ³æ’­æ”¾é…ç½®  
    sound_types: ['gaga101', 'gaga102', 'gaga103', 'gaga104']  # å¸¸è§„å£°éŸ³ç±»å‹åˆ—è¡¨
    moon_type: 'moon101'                    # ä½ç”µé‡å£°éŸ³ç±»å‹
    min_play_interval: 2                    # æœ€å°æ’­æ”¾é—´éš”ï¼ˆç§’ï¼‰
    max_play_interval: 10                   # æœ€å¤§æ’­æ”¾é—´éš”ï¼ˆç§’ï¼‰
    min_play_count: 1                       # æœ€å°æ’­æ”¾æ¬¡æ•°
    max_play_count: 3                       # æœ€å¤§æ’­æ”¾æ¬¡æ•°