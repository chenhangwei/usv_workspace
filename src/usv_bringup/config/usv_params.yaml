# =============================================================================
# USV系统参数配置文件
# 该文件定义了USV系统中各节点的参数配置
# =============================================================================

# =============================================================================
# 飞控通信模块参数 (MAVROS)
# 
# 多 USV 机载计算机的 system_id 配置说明:
# 
# 场景: 多台独立 USV,每台有自己的机载计算机(gauss02/gauss03)和飞控
# 
# system_id 设置原则:
# 1. 每个机载计算机使用唯一的 system_id (推荐: usv_02用2, usv_03用3)
# 2. 所有飞控统一使用 system_id=1 (ArduPilot 标准)
# 3. 地面站使用 system_id=255 (GCS 标准)
# 
# MAVLink 路由工作原理:
# - 飞控会记住"从哪个串口收到哪个 sysid 的消息"
# - 当收到目标为某 sysid 的消息时,飞控会转发到对应串口
# - 这样地面站(sysid=255)可以通过飞控与机载电脑(sysid=2/3)通信
# 
# ⚠️ 关键: target_system_id 必须设为 1 (飞控ID),否则无法接收飞控心跳!
# =============================================================================
mavros:
  ros__parameters:
    # ==================== MAVLink 身份配置 ====================
    # 注意: system_id/target_system_id 等参数已移至 launch 文件中配置
    # 请在 usv_launch.py 中修改 target_system_id:
    # - usv_02: target_system_id = 2 (匹配飞控 SYSID_THISMAV=2)
    # - usv_03: target_system_id = 3 (匹配飞控 SYSID_THISMAV=3)
    
    # ==================== 插件配置（已移至 launch 文件）====================
    # ⚠️ 插件黑名单配置已移至 usv_launch.py，此处配置已失效
    # 请在 launch 文件中修改 plugin_blacklist 参数
    # 
    # 保留的核心插件（15个）：
    # sys_status, sys_time, command, local_position, global_position,
    # home_position, gps_status, battery, imu, rc_io, setpoint_raw,
    # waypoint, rallypoint, geofence, vfr_hud
    
    # ==================== 性能优化参数（已移至 launch 文件）====================
    # 以下参数已在 launch 文件中配置，此处保留仅作为文档参考
    # sys.disable_diag: true
    # mission.pull_after_gcs: false
    # waypoint.pull_after_gcs: false
    # rallypoint.pull_after_gcs: false
    # geofence.pull_after_gcs: false
    
    # 连接参数（保留作为默认值）
    conn:
      timeout: 10.0                         # 连接超时时间（秒）
      heartbeat_mav_type: 6                 # MAV_TYPE_SURFACE_BOAT
      heartbeat_rate: 1.0                   # 心跳频率（Hz）
      
    # 视觉定位配置
    vision_pose:
      enable: false                         # 禁用视觉定位

# =============================================================================
# 通信与状态管理模块参数
# =============================================================================
usv_status_node:
  ros__parameters:
    # 电池电压范围配置（基于实际电池特性）
    battery_voltage_full: 12.6              # 满电电压（V）- 电量显示100%
    battery_voltage_empty: 10.8             # 空电电压（V）- 电量显示0%，需要充电

# NavigateToPoint Action Server 参数（统一的导航到达阈值配置）
navigate_to_point_server:
  ros__parameters:
    nav_arrival_threshold: 1.0              # 到达目标点的距离阈值（米）- 统一使用此参数
    nav_timeout_check_period: 1.0           # 超时检查周期（秒）
    nav_feedback_period: 0.5                # 反馈发布周期（秒）
    distance_mode: '2d'                     # 距离计算模式：'2d'（仅XY平面）或 '3d'（包含Z轴）

# Auto Set Home 参数（关键：延长 GPS 初始化时间，避免 z 坐标误差）
auto_set_home_node:
  ros__parameters:
    set_delay_sec: 10.0                     # GPS 高度收敛等待时间（秒），建议 8-15 秒
    use_current_gps: true                   # 使用当前 GPS 位置作为 Home 点

# =============================================================================
# GPS 坐标转换模块参数（统一的 GPS 原点配置）
# 
# ⚠️ 重要说明：
# 所有 USV 使用统一的 GPS 原点（A0 基站）进行坐标转换
# - gps_to_local_node: 将飞控的 GPS 位置转换为本地 XYZ 坐标
# - coord_transform_node: 将地面站的 XYZ 目标点转换为 GPS 坐标
# 
# GPS 原点（A0 基站）：22.5180977°N, 113.9007239°E, -5.17m
# =============================================================================

gps_to_local_node:
  ros__parameters:
    gps_origin_lat: 22.5180977              # 北纬（度）
    gps_origin_lon: 113.9007239             # 东经（度）
    gps_origin_alt: -5.17                   # 海拔（米，A0 基站实测值）
    publish_rate: 10.0                      # 发布频率（Hz），推荐 10-20 Hz
    enable_gps_to_local: true               # 启用 GPS→本地坐标转换

coord_transform_node:
  ros__parameters:
    gps_origin_lat: 22.5180977              # 北纬（度）
    gps_origin_lon: 113.9007239             # 东经（度）
    gps_origin_alt: -5.17                   # 海拔（米，A0 基站实测值）
    enable_coord_transform: true            # 启用 XYZ→GPS 坐标转换（接收地面站+避障目标点）
    use_global_position_target: true        # true=GlobalPositionTarget (推荐), false=GeoPoseStamped

# =============================================================================
# 控制模块参数
# =============================================================================
usv_avoidance_node:
  ros__parameters:
    # 避障距离参数
    in_distance_value: 1.0                  # 避障触发距离（米）

usv_command_node:
  ros__parameters:
    # 支持的飞行模式列表
    supported_modes: ['GUIDED', 'MANUAL', 'AUTO', 'HOLD', 'ARCO', 'STEERING']
    # 服务超时时间
    service_timeout_sec: 5.0                # 服务等待超时时间（秒）
    # 解锁命令超时时间
    arming_command_timeout_sec: 10.0        # 解锁命令超时时间（秒）

usv_control_node:
  ros__parameters:
    publish_rate: 20.0                      # 目标点发布频率（Hz）
    frame_id: 'map'                         # 坐标系ID
    coordinate_frame: 8                     # FRAME_LOCAL_NED = 8
    enable_local_control: false             # 是否启用局部控制（false=使用coord_transform_node的全局GPS模式）

# =============================================================================
# 传感器驱动模块参数
# =============================================================================
usv_uwb_node:
  ros__parameters:
    dummy_param: true                       # 占位参数

# =============================================================================
# 辅助功能模块参数
# =============================================================================
usv_head_action_node:
  ros__parameters:
    # 默认为无硬件模式，避免在无 I2C/PCA9685 环境崩溃
    enable_head_actuator: false            # 设置为 true 以启用实际硬件控制

usv_fan_node:
  ros__parameters:
    # 风扇控制引脚配置
    fan_pin: 17                             # BCM编号，GPIO17
    gpio_chip: gpiochip4                    # GPIO芯片名称
    # 温度阈值配置（单位：毫摄氏度）
    temp_threshold_on: 50000                # 风扇开启温度阈值 50°C
    temp_threshold_off: 45000               # 风扇关闭温度阈值 45°C

usv_led_node:
  ros__parameters:
    # LED控制串口配置
    port: /dev/ttyUSB1                      # 串口设备路径
    baudrate: 115200                        # 波特率
    # LED效果配置
    color_list: [255, 0, 0, 255, 127, 0, 255, 255, 0, 0, 255, 0, 0, 255, 255, 0, 0, 255, 139, 0, 255]  # 颜色列表 [R,G,B,R,G,B,...]
    timer_period_high: 0.03                 # 高频定时器周期（秒）
    timer_period_low: 0.5                   # 低频定时器周期（秒）
    transition_duration: 3.0                # 颜色渐变持续时间（秒）
    hold_duration: 10.0                     # 颜色停留时间（秒）
    breath_step: 6                          # 呼吸灯步进值

usv_sound_node:
  ros__parameters:
    # 声音播放配置  
    sound_types: ['gaga101', 'gaga102', 'gaga103', 'gaga104']  # 常规声音类型列表
    moon_type: 'moon101'                    # 低电量声音类型
    min_play_interval: 2                    # 最小播放间隔（秒）
    max_play_interval: 10                   # 最大播放间隔（秒）
    min_play_count: 1                       # 最小播放次数
    max_play_count: 3                       # 最大播放次数