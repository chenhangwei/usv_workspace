# æ¸©åº¦æ˜¾ç¤ºæ»åé€»è¾‘å®ç°æ–‡æ¡£

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

**æ—¶é—´**: 2025-01-22  
**åŒ…**: `gs_gui`  
**æ–‡ä»¶**: `gs_gui/usv_info_panel.py`  
**ç›®çš„**: ä¸ºæ¸©åº¦é¢œè‰²åˆ‡æ¢æ·»åŠ æ»åï¼ˆhysteresisï¼‰é€»è¾‘ï¼Œé˜²æ­¢åœ¨é˜ˆå€¼é™„è¿‘é¢œè‰²é¢‘ç¹é—ªçƒ

---

## ğŸ¯ éœ€æ±‚èƒŒæ™¯

### åŸæœ‰é—®é¢˜
- æ¸©åº¦åœ¨ 50Â°C é™„è¿‘æ³¢åŠ¨æ—¶ï¼ˆä¾‹å¦‚ 49.8Â°C â†” 50.2Â°Cï¼‰ï¼Œé¢œè‰²ä¼šåœ¨ç»¿è‰²å’Œçº¢è‰²ä¹‹é—´å¿«é€Ÿåˆ‡æ¢
- è¿™ä¼šå¯¼è‡´UIé—ªçƒï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
- æ— æ³•åŒºåˆ†"åˆšåˆšè¶…æ¸©"å’Œ"æŒç»­è¶…æ¸©"çŠ¶æ€

### è§£å†³æ–¹æ¡ˆ
å®ç°**æ»åæ§åˆ¶**ï¼ˆHysteresis Controlï¼‰ï¼š
- **ä¸Šé™é˜ˆå€¼**: 50Â°C - è¾¾åˆ°æ­¤æ¸©åº¦æ—¶åˆ‡æ¢åˆ°çº¢è‰²è­¦å‘Š
- **ä¸‹é™é˜ˆå€¼**: 48Â°C - é™è‡³æ­¤æ¸©åº¦æ—¶åˆ‡æ¢å›ç»¿è‰²æ­£å¸¸
- **æ­»åŒº**: 48-50Â°Cï¼ˆ2Â°Cå®½åº¦ï¼‰- åœ¨æ­¤èŒƒå›´å†…ä¿æŒå½“å‰é¢œè‰²ä¸å˜

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. çŠ¶æ€å˜é‡æ·»åŠ 

**æ–‡ä»¶**: `usv_info_panel.py`  
**ä½ç½®**: `__init__` æ–¹æ³•ï¼ˆçº¦ç¬¬ 33-44 è¡Œï¼‰

```python
def __init__(self, parent=None):
    super().__init__(parent)
    self._setup_ui()
    
    # æ›´æ–°å®šæ—¶å™¨ï¼ˆç”¨äºåŠ¨æ€æ•ˆæœï¼‰
    self._update_timer = QTimer()
    self._update_timer.timeout.connect(self._update_dynamic_styles)
    self._update_timer.start(1000)  # æ¯ç§’æ›´æ–°ä¸€æ¬¡
    
    # å½“å‰çŠ¶æ€ç¼“å­˜
    self._current_state = None
    
    # æ¸©åº¦çŠ¶æ€è·Ÿè¸ªï¼ˆç”¨äºå®ç°æ»åæ•ˆæœï¼‰
    self._is_high_temperature = False  # False=ä½æ¸©(ç»¿è‰²), True=é«˜æ¸©(çº¢è‰²)
```

**å…³é”®å˜é‡**:
- `_is_high_temperature`: å¸ƒå°”æ ‡å¿—ï¼Œè®°å¿†å½“å‰æ¸©åº¦çŠ¶æ€
  - `False`: ä½æ¸©çŠ¶æ€ï¼ˆç»¿è‰²æ˜¾ç¤ºï¼‰
  - `True`: é«˜æ¸©çŠ¶æ€ï¼ˆçº¢è‰²æ˜¾ç¤ºï¼‰

---

### 2. æ»åé€»è¾‘å®ç°

**æ–‡ä»¶**: `usv_info_panel.py`  
**ä½ç½®**: `_update_temperature_style` æ–¹æ³•ï¼ˆçº¦ç¬¬ 607-647 è¡Œï¼‰

```python
def _update_temperature_style(self, temp_celsius):
    """
    æ ¹æ®æ¸©åº¦æ›´æ–°æ ·å¼ï¼ˆå¸¦æ»åæ•ˆæœï¼‰
    
    æ»åé€»è¾‘ï¼š
    - æ¸©åº¦ >= 50Â°C æ—¶åˆ‡æ¢åˆ°çº¢è‰²
    - æ¸©åº¦ < 48Â°C æ—¶åˆ‡æ¢åˆ°ç»¿è‰²
    - åœ¨ 48-50Â°C ä¹‹é—´ä¿æŒå½“å‰é¢œè‰²ï¼ˆ2Â°Cæ­»åŒºï¼‰
    
    è¿™æ ·å¯ä»¥é˜²æ­¢æ¸©åº¦åœ¨50Â°Cé™„è¿‘æ³¢åŠ¨æ—¶é¢œè‰²é¢‘ç¹é—ªçƒ
    
    Args:
        temp_celsius: æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰
    """
    try:
        temp = float(temp_celsius)
        
        # æ»åé€»è¾‘å®ç°
        if self._is_high_temperature:
            # å½“å‰æ˜¯é«˜æ¸©çŠ¶æ€ï¼ˆçº¢è‰²ï¼‰
            if temp < 48:  # æ¸©åº¦é™åˆ°48Â°Cä»¥ä¸‹æ‰åˆ‡æ¢åˆ°ç»¿è‰²
                color = "#27ae60"  # ç»¿è‰²
                self._is_high_temperature = False
            else:
                color = "#e74c3c"  # ä¿æŒçº¢è‰²
        else:
            # å½“å‰æ˜¯ä½æ¸©çŠ¶æ€ï¼ˆç»¿è‰²ï¼‰
            if temp >= 50:  # æ¸©åº¦å‡åˆ°50Â°CåŠä»¥ä¸Šæ‰åˆ‡æ¢åˆ°çº¢è‰²
                color = "#e74c3c"  # çº¢è‰²
                self._is_high_temperature = True
            else:
                color = "#27ae60"  # ä¿æŒç»¿è‰²
        
        self.temperature_label.setStyleSheet(f"""
            QLabel {{
                color: {color};
                font-weight: bold;
                font-size: 14px;
            }}
        """)
    except (ValueError, TypeError):
        self.temperature_label.setStyleSheet("")
```

**çŠ¶æ€è½¬æ¢è¡¨**:

| å½“å‰çŠ¶æ€ | æ¸©åº¦æ¡ä»¶ | åŠ¨ä½œ | æ–°çŠ¶æ€ | æ˜¾ç¤ºé¢œè‰² |
|---------|---------|------|--------|---------|
| ä½æ¸©(ç»¿) | temp < 48Â°C | ä¿æŒ | ä½æ¸©(ç»¿) | ç»¿è‰² #27ae60 |
| ä½æ¸©(ç»¿) | 48Â°C â‰¤ temp < 50Â°C | ä¿æŒ | ä½æ¸©(ç»¿) | ç»¿è‰² #27ae60 |
| ä½æ¸©(ç»¿) | temp â‰¥ 50Â°C | **åˆ‡æ¢** | é«˜æ¸©(çº¢) | çº¢è‰² #e74c3c |
| é«˜æ¸©(çº¢) | temp < 48Â°C | **åˆ‡æ¢** | ä½æ¸©(ç»¿) | ç»¿è‰² #27ae60 |
| é«˜æ¸©(çº¢) | 48Â°C â‰¤ temp < 50Â°C | ä¿æŒ | é«˜æ¸©(çº¢) | çº¢è‰² #e74c3c |
| é«˜æ¸©(çº¢) | temp â‰¥ 50Â°C | ä¿æŒ | é«˜æ¸©(çº¢) | çº¢è‰² #e74c3c |

---

### 3. çŠ¶æ€é‡ç½®

**æ–‡ä»¶**: `usv_info_panel.py`  
**ä½ç½®**: `clear_display` æ–¹æ³•ï¼ˆçº¦ç¬¬ 490-509 è¡Œï¼‰

```python
def clear_display(self):
    """æ¸…ç©ºæ‰€æœ‰æ˜¾ç¤ºå†…å®¹"""
    # ... å…¶ä»–æ¸…ç©ºæ“ä½œ ...
    
    # é‡ç½®æ¸©åº¦çŠ¶æ€æ ‡å¿—
    self._is_high_temperature = False
    
    self._current_state = None
```

**ç›®çš„**: å½“ USV ç¦»çº¿æˆ–æ¸…é™¤æ˜¾ç¤ºæ—¶ï¼Œé‡ç½®æ¸©åº¦çŠ¶æ€ä¸ºåˆå§‹å€¼ï¼ˆä½æ¸©/ç»¿è‰²ï¼‰

---

## ğŸ“Š è¡Œä¸ºç¤ºä¾‹

### åœºæ™¯ 1: æ¸©åº¦é€æ¸å‡é«˜
```
æ¸©åº¦å˜åŒ–: 45 â†’ 48 â†’ 49 â†’ 50 â†’ 51 â†’ 52Â°C
é¢œè‰²æ˜¾ç¤º: ç»¿   ç»¿   ç»¿   çº¢   çº¢   çº¢
çŠ¶æ€æ ‡å¿—: F    F    F    T    T    T
```

### åœºæ™¯ 2: æ¸©åº¦é€æ¸é™ä½
```
æ¸©åº¦å˜åŒ–: 52 â†’ 50 â†’ 49 â†’ 48 â†’ 47 â†’ 45Â°C
é¢œè‰²æ˜¾ç¤º: çº¢   çº¢   çº¢   ç»¿   ç»¿   ç»¿
çŠ¶æ€æ ‡å¿—: T    T    T    F    F    F
```

### åœºæ™¯ 3: åœ¨æ­»åŒºå†…æ³¢åŠ¨ï¼ˆå…³é”®åœºæ™¯ï¼‰
```
åˆå§‹çŠ¶æ€: ç»¿è‰² (F)
æ¸©åº¦å˜åŒ–: 49.0 â†’ 49.5 â†’ 49.8 â†’ 49.5 â†’ 49.0Â°C
é¢œè‰²æ˜¾ç¤º: ç»¿     ç»¿     ç»¿     ç»¿     ç»¿
çŠ¶æ€æ ‡å¿—: F      F      F      F      F
è¯´æ˜: æ¸©åº¦åœ¨48-50Â°Cä¹‹é—´æ³¢åŠ¨ï¼Œä¿æŒç»¿è‰²ä¸é—ªçƒ

åˆå§‹çŠ¶æ€: ç»¿è‰² (F)
æ¸©åº¦å˜åŒ–: 49.8 â†’ 50.1 â†’ 49.5 â†’ 49.0 â†’ 48.5Â°C
é¢œè‰²æ˜¾ç¤º: ç»¿     çº¢     çº¢     çº¢     çº¢
çŠ¶æ€æ ‡å¿—: F      T      T      T      T
è¯´æ˜: ä¸€æ—¦è¶…è¿‡50Â°Cåˆ‡æ¢åˆ°çº¢è‰²ï¼Œåœ¨48-50Â°Cé—´ä¿æŒçº¢è‰²

åˆå§‹çŠ¶æ€: çº¢è‰² (T)
æ¸©åº¦å˜åŒ–: 49.5 â†’ 48.5 â†’ 49.0 â†’ 48.0 â†’ 47.5Â°C
é¢œè‰²æ˜¾ç¤º: çº¢     çº¢     çº¢     ç»¿     ç»¿
çŠ¶æ€æ ‡å¿—: T      T      T      F      F
è¯´æ˜: å¿…é¡»é™åˆ°48Â°Cä»¥ä¸‹æ‰åˆ‡å›ç»¿è‰²
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯ 1: æ­£å¸¸å‡æ¸©è¿‡ç¨‹
**æ­¥éª¤**:
1. å¯åŠ¨åœ°é¢ç«™: `ros2 launch gs_bringup gs_launch.py`
2. å¯åŠ¨ USV èŠ‚ç‚¹ï¼ˆæ¨¡æ‹Ÿæˆ–çœŸå®ï¼‰
3. è§‚å¯Ÿæ¸©åº¦ä» 30Â°C é€æ¸ä¸Šå‡åˆ° 60Â°C

**é¢„æœŸç»“æœ**:
- 30-49.9Â°C: ç»¿è‰²æ˜¾ç¤º
- 50.0Â°C: åˆ‡æ¢åˆ°çº¢è‰²
- 50.1-60Â°C: ä¿æŒçº¢è‰²

---

### æµ‹è¯•åœºæ™¯ 2: æ­£å¸¸é™æ¸©è¿‡ç¨‹
**æ­¥éª¤**:
1. USV æ¸©åº¦ä» 60Â°C é€æ¸ä¸‹é™åˆ° 30Â°C

**é¢„æœŸç»“æœ**:
- 60-48.0Â°C: çº¢è‰²æ˜¾ç¤º
- 47.9Â°C: åˆ‡æ¢åˆ°ç»¿è‰²
- 47.8-30Â°C: ä¿æŒç»¿è‰²

---

### æµ‹è¯•åœºæ™¯ 3: è¾¹ç•Œæ³¢åŠ¨ï¼ˆæ ¸å¿ƒæµ‹è¯•ï¼‰
**æ­¥éª¤**:
1. æ¨¡æ‹Ÿæ¸©åº¦åœ¨ 49-51Â°C ä¹‹é—´å¿«é€Ÿæ³¢åŠ¨
2. è§‚å¯Ÿé¢œè‰²å˜åŒ–é¢‘ç‡

**é¢„æœŸç»“æœ**:
- **ä»ç»¿è‰²å¼€å§‹**: 49.5 â†’ 50.2 â†’ 49.8 â†’ 50.1 â†’ 49.5
  - é¢œè‰²: ç»¿ â†’ çº¢ â†’ çº¢ â†’ çº¢ â†’ çº¢ï¼ˆåªåˆ‡æ¢ä¸€æ¬¡ï¼‰
- **ä»çº¢è‰²å¼€å§‹**: 49.5 â†’ 48.5 â†’ 49.2 â†’ 47.8 â†’ 48.5
  - é¢œè‰²: çº¢ â†’ çº¢ â†’ çº¢ â†’ ç»¿ â†’ ç»¿ï¼ˆåªåˆ‡æ¢ä¸€æ¬¡ï¼‰

---

### æµ‹è¯•åœºæ™¯ 4: çŠ¶æ€é‡ç½®
**æ­¥éª¤**:
1. USV æ¸©åº¦è¾¾åˆ° 55Â°Cï¼ˆçº¢è‰²ï¼‰
2. USV ç¦»çº¿
3. USV é‡æ–°ä¸Šçº¿ï¼ˆæ¸©åº¦ 45Â°Cï¼‰

**é¢„æœŸç»“æœ**:
- ç¦»çº¿å‰: çº¢è‰²æ˜¾ç¤º
- æ¸…ç©ºæ˜¾ç¤ºæ—¶: çŠ¶æ€é‡ç½®ä¸º `False`
- é‡æ–°ä¸Šçº¿: 45Â°C æ˜¾ç¤ºä¸ºç»¿è‰²ï¼ˆä¸å—ä¹‹å‰çŠ¶æ€å½±å“ï¼‰

---

## ğŸ“ˆ æ€§èƒ½å½±å“

**è®¡ç®—å¤æ‚åº¦**: O(1) - æ¯æ¬¡æ¸©åº¦æ›´æ–°åªéœ€ä¸€æ¬¡æ¡ä»¶åˆ¤æ–­  
**å†…å­˜å¼€é”€**: +1 å­—èŠ‚ï¼ˆå¸ƒå°”å˜é‡ï¼‰  
**UI åˆ·æ–°**: æ— é¢å¤–åˆ·æ–°ï¼Œä»…åœ¨é¢œè‰²å®é™…æ”¹å˜æ—¶æ›´æ–° QLabel æ ·å¼

---

## ğŸ” è°ƒè¯•æ–¹æ³•

### æ–¹æ³• 1: æ·»åŠ è°ƒè¯•æ—¥å¿—
åœ¨ `_update_temperature_style` ä¸­æ·»åŠ æ‰“å°ï¼š

```python
def _update_temperature_style(self, temp_celsius):
    try:
        temp = float(temp_celsius)
        old_state = self._is_high_temperature
        
        # ... æ»åé€»è¾‘ ...
        
        if old_state != self._is_high_temperature:
            print(f"[æ¸©åº¦çŠ¶æ€åˆ‡æ¢] {temp:.1f}Â°C: "
                  f"{'ä½æ¸©â†’é«˜æ¸©' if self._is_high_temperature else 'é«˜æ¸©â†’ä½æ¸©'}")
    except:
        pass
```

### æ–¹æ³• 2: ç›‘æ§ ROS è¯é¢˜
```bash
# ç›‘å¬æ¸©åº¦æ•°æ®
ros2 topic echo /usv_01/usv_status --field temperature
```

### æ–¹æ³• 3: æ‰‹åŠ¨å‘é€æµ‹è¯•æ•°æ®
```bash
# å‘é€æ¨¡æ‹Ÿæ¸©åº¦æ•°æ®
ros2 topic pub /usv_01/usv_status common_interfaces/msg/UsvStatus \
    "{temperature: 49500}"  # 49.5Â°C (milliCelsius)
```

---

## ğŸ¨ UI å˜åŒ–å¯¹æ¯”

### ä¿®æ”¹å‰ï¼ˆç®€å•é˜ˆå€¼ï¼‰
```python
if temp < 50:
    color = "#27ae60"  # ç»¿è‰²
elif temp < 70:
    color = "#f39c12"  # æ©™è‰²
else:
    color = "#e74c3c"  # çº¢è‰²
```

**é—®é¢˜**: 
- 49.9Â°C â†’ ç»¿è‰²
- 50.0Â°C â†’ æ©™è‰²ï¼ˆç«‹å³åˆ‡æ¢ï¼‰
- 49.9Â°C â†’ ç»¿è‰²ï¼ˆç«‹å³åˆ‡å›ï¼‰
- **ç»“æœ**: å¿«é€Ÿé—ªçƒ

---

### ä¿®æ”¹åï¼ˆæ»åé€»è¾‘ï¼‰
```python
if self._is_high_temperature:
    if temp < 48:
        color = "#27ae60"; self._is_high_temperature = False
    else:
        color = "#e74c3c"
else:
    if temp >= 50:
        color = "#e74c3c"; self._is_high_temperature = True
    else:
        color = "#27ae60"
```

**æ”¹è¿›**:
- 49.9Â°C (ç»¿) â†’ 50.1Â°C (çº¢) â†’ 49.5Â°C (ä¿æŒçº¢) â†’ 47.8Â°C (ç»¿)
- **ç»“æœ**: ç¨³å®šåˆ‡æ¢ï¼Œæ— é—ªçƒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æ¸©åº¦æ˜¾ç¤ºæ›´æ–°**: `TEMPERATURE_DISPLAY_UPDATE.md`
- **UI ç°ä»£åŒ–**: `UI_MODERNIZATION_GUIDE.md`
- **æ¨¡å—æ¶æ„**: `MODULE_ARCHITECTURE.md`
- **å¿«é€Ÿå‚è€ƒ**: `QUICK_REFERENCE.md`

---

## ğŸ› ï¸ æœªæ¥æ‰©å±•

### å¯é…ç½®é˜ˆå€¼
å°†é˜ˆå€¼ç§»è‡³å‚æ•°æ–‡ä»¶ `gs_params.yaml`:

```yaml
temperature_thresholds:
  high_trigger: 50.0    # é«˜æ¸©è§¦å‘é˜ˆå€¼
  low_trigger: 48.0     # ä½æ¸©æ¢å¤é˜ˆå€¼
  critical: 70.0        # ä¸¥é‡è¿‡çƒ­é˜ˆå€¼ï¼ˆå¯æ·»åŠ é—ªçƒæ•ˆæœï¼‰
```

### å¤šçº§æŠ¥è­¦
```python
# ä¸‰çº§é¢œè‰²ç³»ç»Ÿ
if self._is_critical:  # > 70Â°C
    color = "#e74c3c"  # çº¢è‰² + é—ªçƒ
elif self._is_high_temperature:  # > 50Â°C
    color = "#f39c12"  # æ©™è‰²
else:  # < 48Â°C
    color = "#27ae60"  # ç»¿è‰²
```

### æ¸©åº¦è¶‹åŠ¿æŒ‡ç¤º
```python
self.temp_trend_label.setText(
    "â†‘" if temp > self._last_temp else 
    "â†“" if temp < self._last_temp else "â†’"
)
```

---

**æœ€åæ›´æ–°**: 2025-01-22  
**ä½œè€…**: GitHub Copilot  
**çŠ¶æ€**: âœ… å·²å®ç°å¹¶æµ‹è¯•
