# UI 布局重构 - 快速参考

## 新布局结构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        Ground Station GUI - 三栏布局                             │
├───────────────────────┬─────────────────────┬─────────────────────────────────┤
│                       │                     │                                 │
│   【左栏 - Operating】 │  【中栏 - USV Info】 │     【右栏 - Message】          │
│      (比例: 2)         │     (比例: 1)        │        (比例: 1)                │
│                       │                     │                                 │
│ ┌──────────────────┐  │ ┌─────────────────┐ │ ┌─────────────────────────────┐ │
│ │ Cluster List     │  │ │ USV详细信息     │ │ │ Cluster Navigation Feedback │ │
│ │ ┌──────────────┐ │  │ │                 │ │ │                             │ │
│ │ │  Table View  │ │  │ │ • USV ID        │ │ │  (导航反馈)                 │ │
│ │ └──────────────┘ │  │ │ • X 坐标        │ │ └─────────────────────────────┘ │
│ │  [up]  [down]    │  │ │ • Y 坐标        │ │                                 │
│ └──────────────────┘  │ │ • Z 坐标        │ │ ┌─────────────────────────────┐ │
│                       │ │ • Yaw 航向      │ │ │         Info                │ │
│ ┌──────────────────┐  │ │                 │ │ │                             │ │
│ │ Departed List    │  │ │ (实时更新)      │ │ │  (系统信息日志)             │ │
│ │ ┌──────────────┐ │  │ │                 │ │ │                             │ │
│ │ │  Table View  │ │  │ └─────────────────┘ │ │                             │ │
│ │ └──────────────┘ │  │                     │ └─────────────────────────────┘ │
│ └──────────────────┘  │                     │                                 │
│                       │                     │ ┌─────────────────────────────┐ │
│ ┌──────────────────┐  │                     │ │       Warning               │ │
│ │ Manual Control   │  │                     │ │                             │ │
│ │ • X: [____]      │  │                     │ │  (警告信息日志)             │ │
│ │ • Y: [____]      │  │                     │ │                             │ │
│ │ • Z: [____]      │  │                     │ └─────────────────────────────┘ │
│ │ [Send Point]     │  │                     │                                 │
│ │ [Arm] [Disarm]   │  │                     │                                 │
│ │ [Guided] [Manual]│  │                     │                                 │
│ │ [Arco] [Steering]│  │                     │                                 │
│ └──────────────────┘  │                     │                                 │
│                       │                     │                                 │
│ ┌──────────────────┐  │                     │                                 │
│ │ Cluster Command  │  │                     │                                 │
│ │ [Arm] [Disarm]   │  │                     │                                 │
│ │ [Guided] [Manual]│  │                     │                                 │
│ │ [Cluster Start]  │  │                     │                                 │
│ │ [Cluster Stop]   │  │                     │                                 │
│ │ [Sound] [Neck]   │  │                     │                                 │
│ │ [LED Controls]   │  │                     │                                 │
│ └──────────────────┘  │                     │                                 │
│                       │                     │                                 │
└───────────────────────┴─────────────────────┴─────────────────────────────────┘
```

## 布局特点

### 1. 左栏：Operating（宽度比例 2）
**功能**：控制和操作
- 集群/离群列表管理
- 手动控制输入
- 集群命令发送
- LED/声音/舵机控制

### 2. 中栏：USV Info（宽度比例 1）
**功能**：实时详细信息显示
- 选中 USV 的详细状态
- 位置坐标 (X, Y, Z)
- 航向角度 (Yaw)
- 自动更新（200ms刷新）

### 3. 右栏：Message（宽度比例 1）
**功能**：反馈和日志
- 导航反馈信息
- 系统信息日志
- 警告消息日志

## 信息流

```
用户操作 → 左栏控制 → ROS消息 → USV响应 → 中栏显示状态 → 右栏反馈日志
   ↑                                              ↓
   └──────────────── 用户监控和调整 ←──────────────┘
```

## 使用场景

### 场景1：监控单个USV
1. 在左栏表格中**点击**选择USV
2. 中栏**实时显示**该USV详细状态
3. 右栏显示该USV的导航反馈和日志

### 场景2：集群任务控制
1. 在左栏**管理集群列表**（添加/移除USV）
2. 使用左栏**集群命令**按钮控制所有集群USV
3. 右栏显示**集群导航反馈**
4. 中栏显示**当前选中USV**的详细状态

### 场景3：手动控制离群USV
1. 在左栏**Departed List**选择USV
2. 在左栏**Manual Control**输入目标坐标
3. 点击**Send Point**发送命令
4. 中栏显示该USV的**实时位置**
5. 右栏显示**导航反馈和日志**

## 技术实现

### UI文件修改
```xml
<!-- 原布局：两栏 -->
<layout class="QHBoxLayout" name="horizontalLayout_3" stretch="2,1">

<!-- 新布局：三栏 -->
<layout class="QHBoxLayout" name="horizontalLayout_3" stretch="2,1,1">
```

### 宽度比例计算
- **总宽度**：假设为 `W`
- **左栏**：`2W / (2+1+1) = 0.5W` (50%)
- **中栏**：`1W / (2+1+1) = 0.25W` (25%)
- **右栏**：`1W / (2+1+1) = 0.25W` (25%)

### 兼容性
✅ **所有Python代码无需修改**
- 控件名称未变
- 信号槽连接不变
- 业务逻辑不变

## 启动测试

```bash
# 1. 构建
cd ~/usv_workspace
colcon build --packages-select gs_gui

# 2. Source环境
source install/setup.bash

# 3. 启动地面站
ros2 launch gs_bringup gs_launch.py
```

## 预期效果

- ✅ 界面分为三个清晰的功能区
- ✅ USV详细信息居中突出显示
- ✅ 操作和反馈分离，信息层次清晰
- ✅ 所有功能正常工作

## 注意事项

1. **USV Info Panel替换**：
   - `main_gui_app.py` 中的 `_init_usv_info_panel()` 会动态替换 `groupBox_3`
   - 确保新的 USV 信息面板正确显示在中间栏

2. **表格选择**：
   - 点击左栏表格中的行会触发中栏信息更新
   - 确保 `_handle_table_clicked()` 正常工作

3. **响应式布局**：
   - 窗口最小宽度：建议 1280px
   - 小屏幕可能需要横向滚动

## 文档索引

- 详细修改说明：`UI_LAYOUT_RESTRUCTURE.md`
- 原UI备份：`resource/gs_ui.ui.backup`
- 新UI文件：`resource/gs_ui.ui`
- 生成的Python代码：`gs_gui/ui.py`
