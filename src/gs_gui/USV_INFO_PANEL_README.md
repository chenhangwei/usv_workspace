# USV ä¿¡æ¯é¢æ¿ä¼˜åŒ– - æ€»ç»“

## ğŸ“¦ æ–°å¢æ–‡ä»¶

### 1. æ ¸å¿ƒç»„ä»¶
- **`gs_gui/usv_info_panel.py`** (650+ è¡Œ)
  - ç¾è§‚çš„ USV è¯¦ç»†ä¿¡æ¯æ˜¾ç¤ºé¢æ¿
  - æ”¯æŒåŸºæœ¬ä¿¡æ¯ã€ä½ç½®ã€ç”µæ± ã€GPSã€é€Ÿåº¦ç­‰å¤šç»´åº¦å±•ç¤º
  - æ™ºèƒ½é¢œè‰²ç¼–ç ï¼ˆç”µæ± ã€æ¨¡å¼ã€çŠ¶æ€ç­‰ï¼‰
  - å“åº”å¼å¸ƒå±€ï¼Œé€‚é…ä¸åŒå°ºå¯¸

### 2. æ–‡æ¡£
- **`USV_INFO_PANEL_GUIDE.md`**
  - å®Œæ•´çš„é›†æˆæŒ‡å—
  - ä¸¤ç§é›†æˆæ–¹æ¡ˆï¼ˆåµŒå…¥å¼ / ç‹¬ç«‹çª—å£ï¼‰
  - è¯¦ç»†çš„ API æ–‡æ¡£
  - æ•…éšœæ’æŸ¥æŒ‡å—

### 3. æµ‹è¯•
- **`test/test_usv_info_panel.py`**
  - å•å…ƒæµ‹è¯•ç”¨ä¾‹
  - å¯è§†åŒ–æµ‹è¯•åŠŸèƒ½
  - è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–

### 4. é›†æˆå·¥å…·
- **`scripts/integrate_usv_info_panel.py`**
  - è‡ªåŠ¨é›†æˆè„šæœ¬
  - æ–‡ä»¶å¤‡ä»½
  - ä»£ç ä¿®æ”¹
  - é›†æˆæŠ¥å‘Šç”Ÿæˆ

---

## ğŸ¨ ä¸»è¦æ”¹è¿›

### åŸæœ‰è®¾è®¡çš„é—®é¢˜
```
âŒ ç®€å•çš„æ ‡ç­¾æ˜¾ç¤ºï¼ˆ5ä¸ª QLabelï¼‰
âŒ ä¿¡æ¯ç»´åº¦å•ä¸€ï¼ˆåªæœ‰ IDã€Xã€Yã€Zã€Yawï¼‰
âŒ æ— æ ·å¼åŒºåˆ†ï¼Œè§†è§‰å•è°ƒ
âŒ æ— çŠ¶æ€æŒ‡ç¤ºï¼ˆç”µæ± ã€GPSç­‰ï¼‰
âŒ å›ºå®šå¸ƒå±€ï¼Œä¸æ˜“æ‰©å±•
```

### æ–°è®¾è®¡çš„ä¼˜åŠ¿
```
âœ… åˆ†ç»„ä¿¡æ¯é¢æ¿ï¼ˆ5ä¸ªå½©è‰² GroupBoxï¼‰
âœ… ä¿¡æ¯ç»´åº¦ä¸°å¯Œï¼ˆ15+ ä¸ªæ•°æ®ç‚¹ï¼‰
âœ… æ™ºèƒ½é¢œè‰²ç¼–ç ï¼Œä¸€ç›®äº†ç„¶
âœ… å®æ—¶çŠ¶æ€ç›‘æ§ï¼ˆç”µæ± è¿›åº¦æ¡ã€GPSå«æ˜Ÿæ•°ç­‰ï¼‰
âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
âœ… å•ä½æ ‡æ³¨ï¼Œæ›´ä¸“ä¸š
âœ… Emoji å›¾æ ‡ï¼Œæ›´ç›´è§‚
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | åŸæœ‰ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|---------|--------|
| USV ID | âœ… | âœ… |
| ä½ç½® (X, Y, Z) | âœ… | âœ… |
| èˆªå‘ (Yaw) | âœ… | âœ… |
| é£è¡Œæ¨¡å¼ | âŒ | âœ… (å¸¦é¢œè‰²) |
| ç³»ç»ŸçŠ¶æ€ | âŒ | âœ… (å¸¦é¢œè‰²) |
| è§£é”çŠ¶æ€ | âŒ | âœ… (å¸¦é¢œè‰²) |
| ç”µæ± ç™¾åˆ†æ¯” | âŒ | âœ… (è¿›åº¦æ¡) |
| ç”µæ± ç”µå‹ | âŒ | âœ… |
| ç”µæ± ç”µæµ | âŒ | âœ… |
| GPS å«æ˜Ÿæ•° | âŒ | âœ… (å¸¦é¢œè‰²) |
| GPS ç²¾åº¦ | âŒ | âœ… |
| åœ°é€Ÿ | âŒ | âœ… |
| èˆªå‘è§’ | âŒ | âœ… |
| é¢œè‰²ç¼–ç  | âŒ | âœ… |
| å›¾æ ‡ | âŒ | âœ… |
| è¿›åº¦æ¡ | âŒ | âœ… |
| å•ä½æ ‡æ³¨ | âŒ | âœ… |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: è‡ªåŠ¨é›†æˆï¼ˆæ¨èï¼‰

```bash
cd /home/chenhangwei/usv_workspace/src/gs_gui
python3 scripts/integrate_usv_info_panel.py
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ… å¤‡ä»½åŸæœ‰æ–‡ä»¶
2. âœ… ä¿®æ”¹ `main_gui_app.py`
3. âœ… ä¿®æ”¹ `state_handler.py`
4. âœ… ä¿®æ”¹ `ui_utils.py`
5. âœ… ç”Ÿæˆé›†æˆæŠ¥å‘Š

ç„¶åæ„å»ºï¼š
```bash
cd /home/chenhangwei/usv_workspace
colcon build --packages-select gs_gui
source install/setup.bash
```

### æ–¹æ³• 2: æ‰‹åŠ¨é›†æˆ

å‚è€ƒ `USV_INFO_PANEL_GUIDE.md` ä¸­çš„è¯¦ç»†æ­¥éª¤ã€‚

### æ–¹æ³• 3: å¿«é€Ÿæµ‹è¯•ï¼ˆä¸é›†æˆï¼‰

```bash
cd /home/chenhangwei/usv_workspace/src/gs_gui
python3 test/test_usv_info_panel.py
```

ä¼šæ‰“å¼€ä¸€ä¸ªç‹¬ç«‹çª—å£å±•ç¤ºé¢æ¿æ•ˆæœï¼Œæ¯3ç§’åˆ‡æ¢ä¸€æ¬¡çŠ¶æ€æ•°æ®ã€‚

---

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### é¢œè‰²ä¸»é¢˜
- **åŸºæœ¬ä¿¡æ¯ç»„**: è“è‰²è¾¹æ¡† (#3498db) ğŸ“Œ
- **ä½ç½®ä¿¡æ¯ç»„**: ç»¿è‰²è¾¹æ¡† (#27ae60) ğŸ—ºï¸
- **ç”µæ± ä¿¡æ¯ç»„**: æ©™è‰²è¾¹æ¡† (#f39c12) ğŸ”‹
- **GPS ä¿¡æ¯ç»„**: ç´«è‰²è¾¹æ¡† (#9b59b6) ğŸ›°ï¸
- **é€Ÿåº¦ä¿¡æ¯ç»„**: çº¢è‰²è¾¹æ¡† (#e74c3c) ğŸ’¨

### çŠ¶æ€é¢œè‰²
- **æ¨¡å¼**:
  - GUIDED: ç»¿è‰²èƒŒæ™¯
  - MANUAL: æ©™è‰²èƒŒæ™¯
  - AUTO: è“è‰²èƒŒæ™¯
  
- **ç”µæ± è¿›åº¦æ¡**:
  - >60%: ç»¿è‰²
  - 30-60%: æ©™è‰²
  - <30%: çº¢è‰²

- **GPS å«æ˜Ÿæ•°**:
  - >=10: ç»¿è‰²èƒŒæ™¯
  - 6-9: æ©™è‰²èƒŒæ™¯
  - <6: çº¢è‰²èƒŒæ™¯

- **è§£é”çŠ¶æ€**:
  - å·²è§£é”: çº¢è‰²èƒŒæ™¯
  - å·²é”å®š: ç»¿è‰²èƒŒæ™¯

---

## ğŸ“ å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Œ åŸºæœ¬ä¿¡æ¯                          â”‚
â”‚   ğŸ†” USV ID:   usv_01               â”‚
â”‚   ğŸ¯ æ¨¡å¼:     [GUIDED] (ç»¿)        â”‚
â”‚   ğŸ“Š çŠ¶æ€:     [ACTIVE] (ç»¿)        â”‚
â”‚   ğŸ”“ è§£é”:     [å·²è§£é”] (çº¢)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ—ºï¸ ä½ç½®ä¿¡æ¯                         â”‚
â”‚   X:    10.50 m                     â”‚
â”‚   Y:    -5.20 m                     â”‚
â”‚   Z:     0.30 m                     â”‚
â”‚   Yaw:  45.6Â°                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”‹ ç”µæ± ä¿¡æ¯                          â”‚
â”‚   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 75%        â”‚
â”‚   ç”µå‹:  12.60 V                    â”‚
â”‚   ç”µæµ:   2.30 A                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›°ï¸ GPS ä¿¡æ¯                          â”‚
â”‚   å«æ˜Ÿæ•°:  [12] (ç»¿)                â”‚
â”‚   ç²¾åº¦:     0.80 m                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¨ é€Ÿåº¦ä¿¡æ¯                          â”‚
â”‚   åœ°é€Ÿ:    1.50 m/s                 â”‚
â”‚   èˆªå‘:   48.2Â°                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ è‡ªå®šä¹‰å’Œæ‰©å±•

### æ·»åŠ æ–°å­—æ®µ

åœ¨ `usv_info_panel.py` ä¸­ï¼š

1. **æ·»åŠ æ ‡ç­¾**ï¼ˆåœ¨ `_create_*_group` æ–¹æ³•ä¸­ï¼‰ï¼š
```python
self.new_field_label = self._create_value_label("--")
layout.addWidget(self._create_key_label("æ–°å­—æ®µ:"), row, 0)
layout.addWidget(self.new_field_label, row, 1)
```

2. **æ›´æ–°é€»è¾‘**ï¼ˆåœ¨ `update_state` æ–¹æ³•ä¸­ï¼‰ï¼š
```python
new_field = state.get('new_field', '--')
self.new_field_label.setText(str(new_field))
```

3. **æ¸…ç©ºé€»è¾‘**ï¼ˆåœ¨ `_clear_display` æ–¹æ³•ä¸­ï¼‰ï¼š
```python
self.new_field_label.setText("--")
```

### ä¿®æ”¹é¢œè‰²ä¸»é¢˜

åœ¨å„ä¸ª `_create_*_group` æ–¹æ³•ä¸­ä¿®æ”¹ `border` é¢œè‰²ï¼š
```python
border: 2px solid #YOUR_COLOR;
```

### æ·»åŠ æŠ¥è­¦åŠŸèƒ½

åœ¨ `_update_dynamic_styles` æ–¹æ³•ä¸­æ·»åŠ é—ªçƒé€»è¾‘ï¼š
```python
def _update_dynamic_styles(self):
    if self._current_state:
        battery = self._current_state.get('battery_percentage', 100)
        if battery < 20:
            # æ·»åŠ é—ªçƒæ•ˆæœ
            self.battery_bar.setStyleSheet("...")
```

---

## âœ… æµ‹è¯•æ¸…å•

è¿è¡Œä»¥ä¸‹æµ‹è¯•ç¡®ä¿é›†æˆæˆåŠŸï¼š

```bash
# 1. å•å…ƒæµ‹è¯•
cd /home/chenhangwei/usv_workspace/src/gs_gui
python3 -m pytest test/test_usv_info_panel.py -v

# 2. å¯è§†åŒ–æµ‹è¯•
python3 test/test_usv_info_panel.py

# 3. é›†æˆæµ‹è¯•
cd /home/chenhangwei/usv_workspace
colcon build --packages-select gs_gui
source install/setup.bash
ros2 launch gs_bringup gs_launch.py

# åœ¨ GUI ä¸­ï¼š
# - é€‰ä¸­ä¸€ä¸ªåœ¨çº¿çš„ USV
# - æ£€æŸ¥å³ä¾§ä¿¡æ¯é¢æ¿æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
# - åˆ‡æ¢ä¸åŒçš„ USVï¼Œæ£€æŸ¥ä¿¡æ¯æ˜¯å¦æ›´æ–°
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### æ•°æ®æºè¦æ±‚

ç¡®ä¿ `usv_status_node.py` å‘å¸ƒçš„ `UsvStatus` æ¶ˆæ¯åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```python
# å¿…éœ€å­—æ®µï¼ˆåŸæœ‰ï¼‰
- namespace
- position (x, y, z)
- yaw
- mode
- armed

# å¯é€‰å­—æ®µï¼ˆæ–°å¢ï¼Œå»ºè®®æ·»åŠ ï¼‰
- connected / system_status
- battery_percentage / battery_voltage / battery_current
- temperature
- gps_satellites_visible / gps_eph
- velocity.linear.x / velocity.linear.y
- prearm_ready / prearm_warnings
- sensor_status
- vehicle_messages
```

å¦‚æœæŸäº›å­—æ®µä¸å¯ç”¨ï¼Œé¢æ¿ä¼šæ˜¾ç¤º `--`ï¼Œä¸ä¼šæŠ¥é”™ã€‚

### æ€§èƒ½è€ƒè™‘

- é¢æ¿æ›´æ–°é¢‘ç‡ï¼šç”± `StateHandler` çš„ 200ms å®šæ—¶å™¨æ§åˆ¶
- åŠ¨æ€æ ·å¼æ›´æ–°ï¼š1000ms å®šæ—¶å™¨ï¼ˆå¯ç¦ç”¨ï¼‰
- å»ºè®®åœ¨çº¿ USV æ•°é‡ï¼š<20ï¼ˆé¿å…é¢‘ç¹é‡ç»˜ï¼‰

### å…¼å®¹æ€§

- PyQt5 >= 5.12
- Python >= 3.8
- ROS 2 Humble/Iron

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šé¢æ¿æ˜¾ç¤ºç©ºç™½

**å¯èƒ½åŸå› **: Qt å¸ƒå±€æœªæ­£ç¡®åˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ**: åœ¨ `main_gui_app.py` ä¸­æ‰‹åŠ¨æ¸…é™¤å¹¶æ·»åŠ ï¼š
```python
# æ¸…é™¤åŸæœ‰å†…å®¹
while self.ui.groupBox_3.layout().count():
    item = self.ui.groupBox_3.layout().takeAt(0)
    if item.widget():
        item.widget().deleteLater()

# æ·»åŠ é¢æ¿
self.ui.groupBox_3.layout().addWidget(self.usv_info_panel)
```

### é—®é¢˜ï¼šçŠ¶æ€ä¸æ›´æ–°

**å¯èƒ½åŸå› **: `StateHandler` æœªæ­£ç¡®ä¼ é€’ `usv_info_panel`

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ `state_handler.py` çš„ `__init__` æ˜¯å¦æ¥æ”¶äº†å‚æ•°ï¼š
```python
def __init__(self, table_manager, list_manager, append_warning, usv_info_panel=None):
    self.usv_info_panel = usv_info_panel
```

### é—®é¢˜ï¼šæŸäº›å­—æ®µæ˜¾ç¤º "--"

**å¯èƒ½åŸå› **: çŠ¶æ€æ•°æ®ä¸­ç¼ºå°‘å¯¹åº”å­—æ®µ

**è§£å†³æ–¹æ¡ˆ**: 
1. æ£€æŸ¥ `usv_status_node.py` æ˜¯å¦å¡«å……äº†æ‰€æœ‰å­—æ®µ
2. æˆ–è€…æ¥å—éƒ¨åˆ†å­—æ®µç¼ºå¤±ï¼ˆé¢æ¿å·²å¤„ç†ï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **æ·»åŠ å†å²æ›²çº¿å›¾**
   - é›†æˆ `matplotlib` æ˜¾ç¤ºç”µæ± ã€é€Ÿåº¦æ›²çº¿

2. **æ·»åŠ æŠ¥è­¦ç³»ç»Ÿ**
   - ä½ç”µé‡ã€GPS ä¿¡å·å·®æ—¶å¼¹çª—æç¤º

3. **æ·»åŠ æ•°æ®å¯¼å‡º**
   - å¯¼å‡ºå½“å‰çŠ¶æ€ä¸º JSON/CSV

4. **æ·»åŠ å¤š USV å¯¹æ¯”**
   - å¹¶æ’æ˜¾ç¤ºå¤šä¸ª USV ä¿¡æ¯

5. **æ·»åŠ è‡ªå®šä¹‰ä¸»é¢˜**
   - æ”¯æŒæš—è‰²/äº®è‰²ä¸»é¢˜åˆ‡æ¢

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†é›†æˆæŒ‡å—**: `USV_INFO_PANEL_GUIDE.md`
- **é¡¹ç›®æ¶æ„æ–‡æ¡£**: `MODULE_ARCHITECTURE.md`
- **å¿«é€Ÿå‚è€ƒ**: `QUICK_REFERENCE.md`
- **æµ‹è¯•æŒ‡å—**: `TEST_GUIDE.md`

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. `USV_INFO_PANEL_GUIDE.md` ä¸­çš„æ•…éšœæ’æŸ¥ç« èŠ‚
2. `test/test_usv_info_panel.py` ä¸­çš„æµ‹è¯•ç”¨ä¾‹
3. GitHub Issues

---

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-01  
**ä½œè€…**: GitHub Copilot  
**è®¸å¯**: MIT
