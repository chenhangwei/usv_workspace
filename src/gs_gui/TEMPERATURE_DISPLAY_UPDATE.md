# æ¸©åº¦æ˜¾ç¤ºæ”¹è¿› - æ›´æ–°æ—¥å¿—

## ğŸ“ æ”¹è¿›å†…å®¹

### 1ï¸âƒ£ è¡¨æ ¼æ¸©åº¦æ˜¾ç¤ºä¼˜åŒ–
**ä½ç½®**: é›†ç¾¤åˆ—è¡¨/ç¦»ç¾¤åˆ—è¡¨çš„"æ¸©åº¦"åˆ—

**æ”¹è¿›**:
- âœ… æ¸©åº¦å€¼è‡ªåŠ¨é™¤ä»¥1000ï¼Œè½¬æ¢ä¸ºæ‘„æ°åº¦
- âœ… æ˜¾ç¤ºæ ¼å¼ï¼šä¿ç•™1ä½å°æ•°ï¼ˆä¾‹å¦‚ï¼š`45.3` è€Œä¸æ˜¯ `45300`ï¼‰

**ä»£ç ä½ç½®**: `gs_gui/table_manager.py` - `_format_table_cells()` æ–¹æ³•

```python
# ä¿®æ”¹å‰
temp_text = f"{float(state.get('temperature', 0.0)):.1f}"  # æ˜¾ç¤º 45300.0

# ä¿®æ”¹å  
temp_raw = float(state.get('temperature', 0.0))
temp_celsius = temp_raw / 1000.0
temp_text = f"{temp_celsius:.1f}"  # æ˜¾ç¤º 45.3
```

---

### 2ï¸âƒ£ USVè¯¦ç»†ä¿¡æ¯é¢æ¿æ–°å¢æ¸©åº¦æ˜¾ç¤º
**ä½ç½®**: å³ä¾§"ğŸ”‹ ç”µæ± ä¿¡æ¯"åˆ†ç»„æ¡†å†…

**æ–°å¢å­—æ®µ**:
```
æ¸©åº¦: XX.X â„ƒ
```

**æ™ºèƒ½é¢œè‰²æŒ‡ç¤º**:
- ğŸŸ¢ **ç»¿è‰²** (< 50â„ƒ): æ¸©åº¦æ­£å¸¸
- ğŸŸ  **æ©™è‰²** (50-70â„ƒ): æ¸©åº¦åé«˜ï¼Œè­¦å‘Š
- ğŸ”´ **çº¢è‰²** (> 70â„ƒ): æ¸©åº¦è¿‡çƒ­ï¼Œå±é™©

**ä»£ç ä½ç½®**: `gs_gui/usv_info_panel.py`
- UIåˆ›å»º: `_create_battery_info_group()` æ–¹æ³•
- æ•°æ®æ›´æ–°: `update_state()` æ–¹æ³•
- æ ·å¼æ›´æ–°: `_update_temperature_style()` æ–¹æ³•

---

## ğŸ¨ UIæ•ˆæœé¢„è§ˆ

### è¡¨æ ¼æ˜¾ç¤ºç¤ºä¾‹ï¼š
```
ç¼–å·    | æ¨¡å¼   | ... | æ¸©åº¦
--------|--------|-----|------
usv_01  | HOLD   | ... | 45.3
usv_02  | GUIDED | ... | 52.1
usv_03  | MANUAL | ... | 38.7
```

### è¯¦ç»†ä¿¡æ¯é¢æ¿ç¤ºä¾‹ï¼š
```
ğŸ”‹ ç”µæ± ä¿¡æ¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 75%   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”µå‹: 11.68 V       â”‚
â”‚ ç”µæµ: --    A       â”‚
â”‚ æ¸©åº¦: 45.3  â„ƒ  ğŸŸ¢  â”‚  â† æ–°å¢ï¼Œé¢œè‰²æ ¹æ®æ¸©åº¦å˜åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. å¯åŠ¨ç³»ç»Ÿ
```bash
cd ~/usv_workspace
source install/setup.bash
ros2 launch gs_bringup gs_launch.py
```

### 2. æ£€æŸ¥è¡¨æ ¼æ¸©åº¦åˆ—
- æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨/ç¦»ç¾¤åˆ—è¡¨çš„"æ¸©åº¦"åˆ—
- ç¡®è®¤æ•°å€¼æ˜¾ç¤ºä¸ºåˆç†çš„æ‘„æ°åº¦èŒƒå›´ï¼ˆå¦‚ 30-60ï¼‰
- åŸæœ¬æ˜¾ç¤º 45300 çš„åº”è¯¥å˜æˆ 45.3

### 3. æ£€æŸ¥è¯¦ç»†ä¿¡æ¯é¢æ¿
- åœ¨è¡¨æ ¼ä¸­é€‰ä¸­ä¸€è‰˜USV
- æŸ¥çœ‹å³ä¾§"ğŸ”‹ ç”µæ± ä¿¡æ¯"åˆ†ç»„æ¡†
- ç¡®è®¤"æ¸©åº¦"å­—æ®µæ˜¾ç¤ºï¼Œæ ¼å¼ä¸º `XX.X â„ƒ`
- è§‚å¯Ÿæ¸©åº¦å€¼çš„é¢œè‰²æ˜¯å¦æ ¹æ®æ•°å€¼å˜åŒ–ï¼š
  - ä½æ¸©ï¼ˆ<50â„ƒï¼‰æ˜¾ç¤ºç»¿è‰²
  - ä¸­æ¸©ï¼ˆ50-70â„ƒï¼‰æ˜¾ç¤ºæ©™è‰²
  - é«˜æ¸©ï¼ˆ>70â„ƒï¼‰æ˜¾ç¤ºçº¢è‰²

### 4. æ¨¡æ‹Ÿæ¸©åº¦å˜åŒ–ï¼ˆå¯é€‰ï¼‰
å¦‚æœéœ€è¦æµ‹è¯•é¢œè‰²å˜åŒ–ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æ¸©åº¦å€¼ï¼š
```bash
# å‘å¸ƒæµ‹è¯•æ¸©åº¦ï¼ˆç¤ºä¾‹ï¼‰
ros2 topic pub /usv_01/temperature std_msgs/msg/Float32 "data: 75000.0" --once
```

---

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### æ¸©åº¦æ•°æ®æµ
```
MAVROS (é£æ§)
    â†“ æ¯«æ‘„æ°åº¦ (milli-Â°C)
usv_status_node
    â†“ temperature å­—æ®µ (float, åŸå§‹å€¼)
UsvStatus æ¶ˆæ¯
    â†“
GroundStationNode
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TableManager    â”‚  UsvInfoPanel      â”‚
â”‚  (è¡¨æ ¼æ˜¾ç¤º)      â”‚  (è¯¦ç»†ä¿¡æ¯)         â”‚
â”‚  Ã· 1000          â”‚  Ã· 1000            â”‚
â”‚  æ˜¾ç¤º: XX.X      â”‚  æ˜¾ç¤º: XX.X â„ƒ      â”‚
â”‚                  â”‚  + é¢œè‰²æŒ‡ç¤º         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®è½¬æ¢å…¬å¼
```python
# åŸå§‹å€¼ï¼ˆæ¯«æ‘„æ°åº¦ï¼‰
temperature_raw = 45300.0  # æ¥è‡ªé£æ§

# è½¬æ¢ä¸ºæ‘„æ°åº¦
temperature_celsius = temperature_raw / 1000.0  # 45.3

# æ ¼å¼åŒ–æ˜¾ç¤º
display_text = f"{temperature_celsius:.1f}"  # "45.3"
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: è¡¨æ ¼æ¸©åº¦åˆ—ä»æ˜¾ç¤ºå¤§æ•°å€¼
**å¯èƒ½åŸå› **: æ—§çš„Pythonç¼“å­˜  
**è§£å†³æ–¹æ³•**:
```bash
cd ~/usv_workspace
rm -rf build/gs_gui install/gs_gui
colcon build --packages-select gs_gui
source install/setup.bash
```

### é—®é¢˜2: è¯¦ç»†ä¿¡æ¯é¢æ¿æ¸©åº¦æ˜¾ç¤º"--"
**å¯èƒ½åŸå› **: 
1. æœªé€‰ä¸­ä»»ä½•USV
2. USVçŠ¶æ€ä¸­æ— æ¸©åº¦æ•°æ®

**æ’æŸ¥æ­¥éª¤**:
```bash
# æ£€æŸ¥USVçŠ¶æ€æ¶ˆæ¯
ros2 topic echo /usv_01/usv_state --once | grep temperature
```

### é—®é¢˜3: æ¸©åº¦é¢œè‰²ä¸å˜åŒ–
**å¯èƒ½åŸå› **: æ ·å¼è¡¨ä¼˜å…ˆçº§å†²çª  
**è§£å†³æ–¹æ³•**: æ£€æŸ¥ `modern_style.qss` ä¸­æ˜¯å¦æœ‰è¦†ç›– QLabel æ ·å¼çš„è§„åˆ™

---

## ğŸ“ ä»£ç å˜æ›´æ‘˜è¦

### æ–‡ä»¶1: `gs_gui/table_manager.py`
```python
# Line ~248 (åœ¨ _format_table_cells æ–¹æ³•ä¸­)
- temp_text = f"{float(state.get('temperature', 0.0)):.1f}"
+ temp_raw = float(state.get('temperature', 0.0))
+ temp_celsius = temp_raw / 1000.0
+ temp_text = f"{temp_celsius:.1f}"
```

### æ–‡ä»¶2: `gs_gui/usv_info_panel.py`

**å˜æ›´1: UIåˆ›å»º** (Line ~258)
```python
# åœ¨ _create_battery_info_group() ä¸­æ·»åŠ 
self.temperature_label = self._create_value_label("--")
info_layout.addWidget(self._create_key_label("æ¸©åº¦:"), 2, 0)
info_layout.addWidget(self.temperature_label, 2, 1)
info_layout.addWidget(QLabel("â„ƒ"), 2, 2)
```

**å˜æ›´2: æ•°æ®æ›´æ–°** (Line ~443)
```python
# åœ¨ update_state() ä¸­æ·»åŠ 
temp_raw = float(state.get('temperature', 0.0))
temp_celsius = temp_raw / 1000.0
self.temperature_label.setText(self._format_float(temp_celsius, precision=1))
self._update_temperature_style(temp_celsius)
```

**å˜æ›´3: æ–°å¢æ–¹æ³•** (Line ~607)
```python
def _update_temperature_style(self, temp_celsius):
    """æ ¹æ®æ¸©åº¦æ›´æ–°æ ·å¼"""
    if temp < 50:
        color = "#27ae60"  # ç»¿è‰²
    elif temp < 70:
        color = "#f39c12"  # æ©™è‰²
    else:
        color = "#e74c3c"  # çº¢è‰²
    # ... åº”ç”¨æ ·å¼
```

**å˜æ›´4: æ¸…ç©ºæ˜¾ç¤º** (Line ~493)
```python
# åœ¨ _clear_display() ä¸­æ·»åŠ 
self.temperature_label.setText("--")
```

---

## âœ… éªŒæ”¶æ¸…å•

- [x] è¡¨æ ¼æ¸©åº¦åˆ—æ˜¾ç¤ºåˆç†çš„æ‘„æ°åº¦æ•°å€¼ï¼ˆ30-60èŒƒå›´ï¼‰
- [x] è¯¦ç»†ä¿¡æ¯é¢æ¿æ–°å¢"æ¸©åº¦"å­—æ®µ
- [x] æ¸©åº¦å•ä½æ˜¾ç¤ºä¸º"â„ƒ"
- [x] æ¸©åº¦å€¼ä¿ç•™1ä½å°æ•°
- [x] æ¸©åº¦é¢œè‰²æ ¹æ®æ•°å€¼æ™ºèƒ½å˜åŒ–ï¼ˆç»¿/æ©™/çº¢ï¼‰
- [x] ä»£ç å·²æ„å»ºæˆåŠŸ
- [x] æ— ç¼–è¯‘é”™è¯¯æˆ–è­¦å‘Š

---

**æ›´æ–°æ—¶é—´**: 2025-10-25  
**æ”¹è¿›ç‰ˆæœ¬**: v1.1.0  
**å½±å“ç»„ä»¶**: gs_gui (table_manager, usv_info_panel)
