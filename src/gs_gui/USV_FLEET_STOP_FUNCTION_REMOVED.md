# USV 集群启动器 - 停止功能移除说明

## 修改日期
2025-11-06

## 修改原因
停止功能在实际使用中不可靠，通过 SSH 和远程命令停止 USV 节点存在诸多问题：
- SSH 进程管理复杂，难以保证完全停止
- DDS 节点发现延迟导致状态不同步
- 远程进程可能因网络问题无法正常终止
- 停止逻辑过于复杂，维护困难

**解决方案**：改为通过**物理断电**来关闭 USV 设备，更可靠、更安全。

## 删除的功能

### 1. UI 组件
- ❌ **批量操作区域**：删除"■ 停止选中"按钮
- ❌ **底部按钮**：删除"■ 停止所有 USV"按钮
- ❌ **表格按钮**：删除每行的"■ 停止"按钮

### 2. 代码方法
```python
# 已删除的方法：
- _stop_single(usv_id)           # 停止单个 USV（~170 行代码）
- _stop_selected()                # 停止选中的 USV
- _stop_all()                     # 停止所有 USV
```

### 3. 相关逻辑
- 删除了所有 SSH 进程清理逻辑
- 删除了远程 ROS 节点终止逻辑
- 删除了停止状态验证逻辑

## 保留的功能

✅ **启动功能**：
- 单个启动
- 批量启动选中
- 全选/取消全选

✅ **监控功能**：
- 实时状态检测（离线/启动中/运行中）
- 日志输出
- 刷新状态

✅ **UI 功能**：
- 设备列表显示
- 窗口居中显示
- 现代化暗色主题

## 使用说明

### 启动 USV
1. 打开"USV 集群启动器"
2. 选择要启动的 USV（勾选复选框）
3. 点击"▶ 启动选中"按钮
4. 等待状态变为"运行中"（绿色）

### 停止 USV
⚠️ **重要**：通过以下方式停止 USV：

1. **方法一**：物理断电（推荐）
   - 直接关闭 USV 设备电源
   - 安全、可靠、无需软件操作

2. **方法二**：SSH 手动停止（高级用户）
   ```bash
   # 登录到 USV 机载计算机
   ssh usv@usv_hostname
   
   # 停止 ROS 节点
   pkill -9 -f "ros2 launch"
   
   # 或重启设备
   sudo reboot
   ```

### 注意事项
- 关闭集群启动器窗口**不会**自动停止已运行的 USV
- USV 会继续在后台运行，直到物理断电或手动停止
- 状态监控每 2 秒自动刷新

## 文件修改

**修改文件**：
- `gs_gui/gs_gui/usv_fleet_launcher.py`

**代码统计**：
- 删除代码：~200 行
- 简化按钮：3 个停止按钮 → 0 个
- 精简逻辑：复杂停止流程 → 无

## 优点

✅ **更简单**：代码减少 200+ 行，维护更容易
✅ **更可靠**：物理断电 100% 有效，无网络依赖
✅ **更安全**：避免软件停止失败导致的未知状态
✅ **更清晰**：UI 更简洁，功能更聚焦

## 后续建议

如果将来需要软件停止功能，建议：
1. 在 USV 机载系统安装 `systemd` 服务
2. 通过标准的服务管理命令控制（`systemctl start/stop usv.service`）
3. 实现远程 API 接口，而非直接 SSH 执行命令
4. 增加状态确认机制和超时保护

---

**修改者**：AI Agent  
**审核者**：待审核  
**状态**：已完成 ✓
