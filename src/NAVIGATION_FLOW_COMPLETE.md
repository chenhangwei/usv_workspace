# ğŸš¢ USV å¯¼èˆªé€»è¾‘å®Œæ•´æµç¨‹

## ğŸ“Œ ä½ çš„ç†è§£åŸºæœ¬æ­£ç¡®ï¼

è®©æˆ‘è¯¦ç»†è¯´æ˜æ¯ä¸ªæ­¥éª¤ï¼š

---

## ğŸ¯ å®Œæ•´å¯¼èˆªæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: åœ°é¢ç«™è¯»å– XML ä»»åŠ¡æ–‡ä»¶                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        åœ°é¢ç«™ GUI (main_gui_app.py)
        è¯»å– XML æ–‡ä»¶ä¸­çš„ä»»åŠ¡ç‚¹ï¼ˆç›¸å¯¹äº Area Center çš„åæ ‡ï¼‰
        
        XML ç¤ºä¾‹ï¼š
        <waypoint id="1" x="10.0" y="5.0" z="0.0" />
        <waypoint id="2" x="20.0" y="10.0" z="0.0" />
        
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ç”µæœºé›†ç¾¤ä»»åŠ¡ - Area åç§»è®¡ç®—                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        é›†ç¾¤æ§åˆ¶å™¨ (cluster_controller.py)
        
        æ­¥éª¤ 2.1: ç”¨æˆ·è®¾ç½® Area Center åç§»é‡
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ GUI: åæ ‡ç³»è®¾ç½® â†’ è®¾ç½®åç§»é‡       â”‚
        â”‚ area_center_x: 50.0  (ä¸œå‘50ç±³)    â”‚
        â”‚ area_center_y: 30.0  (åŒ—å‘30ç±³)    â”‚
        â”‚ area_center_z: 0.0   (é«˜åº¦0ç±³)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        æ­¥éª¤ 2.2: åæ ‡è½¬æ¢ (_area_to_global)
        ```python
        # XMLåæ ‡ (ç›¸å¯¹Area Center)
        p_area = {'x': 10.0, 'y': 5.0, 'z': 0.0}
        
        # è½¬æ¢ä¸ºå…¨å±€åæ ‡ (ç›¸å¯¹A0åŸºç«™)
        p_global = _area_to_global(p_area)
        # p_global = {
        #   'x': 50.0 + 10.0 = 60.0,
        #   'y': 30.0 + 5.0 = 35.0,
        #   'z': 0.0 + 0.0 = 0.0
        # }
        ```
        
        æ­¥éª¤ 2.3: å…¨å±€åæ ‡ â†’ USVæœ¬åœ°åæ ‡ (_global_to_usv_local)
        ```python
        # æ³¨æ„ï¼šè¿™ä¸€æ­¥å®é™…ä¸Šæ˜¯"ç›´é€š"è½¬æ¢
        # å› ä¸º USV æœ¬åœ°åæ ‡ç³»ä¹Ÿæ˜¯ä»¥ A0 åŸºç«™ä¸ºåŸç‚¹
        p_local = _global_to_usv_local(usv_id, p_global)
        # p_local = p_global (æ•°å€¼ç›¸åŒ)
        ```
        
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: é€šè¿‡ Action å‘é€å¯¼èˆªç›®æ ‡åˆ° USV                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        åœ°é¢ç«™ (ground_station_node.py)
        è°ƒç”¨ send_nav_goal_via_action()
        
        ```python
        # å‘é€ NavigateToPoint Action
        goal_msg = NavigateToPoint.Goal()
        goal_msg.target_pose.pose.position.x = p_local['x']  # 60.0
        goal_msg.target_pose.pose.position.y = p_local['y']  # 35.0
        goal_msg.target_pose.pose.position.z = p_local['z']  # 0.0
        
        # é€šè¿‡ç½‘ç»œå‘é€åˆ° USV
        action_client.send_goal_async(goal_msg)
        ```
        
                              â†“
                         ç½‘ç»œä¼ è¾“
                   (UDP/TCP to USV)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: USV å¯¼èˆªæœåŠ¡å¤„ç† (Action Server)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        USV æœºè½½ç”µè„‘ (navigate_to_point_server.py)
        
        æ­¥éª¤ 4.1: NavigateToPoint Action Server æ¥æ”¶ç›®æ ‡
        ```python
        async def execute_callback(self, goal_handle):
            target_pose = goal_handle.request.target_pose
            # target_pose.pose.position.x = 60.0
            # target_pose.pose.position.y = 35.0
            # target_pose.pose.position.z = 0.0
        ```
        
        æ­¥éª¤ 4.2: å‘å¸ƒåˆ°æ§åˆ¶èŠ‚ç‚¹
        ```python
        def _send_setpoint_to_control_node(self, target_pose):
            # å‘å¸ƒ PoseStamped åˆ° set_usv_target_position
            self.setpoint_pub.publish(target_pose)
        ```
        
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: åæ ‡è½¬æ¢èŠ‚ç‚¹ - XYZ â†’ GPS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        coord_transform_node.py
        
        æ­¥éª¤ 5.1: æ¥æ”¶ XYZ ç›®æ ‡ç‚¹
        ```python
        # è®¢é˜… set_usv_target_position
        def xyz_target_callback(self, msg: PoseStamped):
            x = msg.pose.position.x  # 60.0 ç±³
            y = msg.pose.position.y  # 35.0 ç±³
            z = msg.pose.position.z  # 0.0 ç±³
        ```
        
        æ­¥éª¤ 5.2: XYZ â†’ GPS è½¬æ¢
        ```python
        def _xyz_to_gps(self, x, y, z):
            # GPS åŸç‚¹ï¼ˆA0åŸºç«™ï¼‰
            origin_lat = 22.5180977  # åŒ—çº¬
            origin_lon = 113.9007239 # ä¸œç»
            origin_alt = -5.17       # æµ·æ‹”
            
            # è®¡ç®—çº¬åº¦åç§»ï¼ˆåŒ—å‘è·ç¦»ï¼‰
            dlat = y / 111320.0
            lat = origin_lat + dlat
            
            # è®¡ç®—ç»åº¦åç§»ï¼ˆä¸œå‘è·ç¦»ï¼‰
            dlon = x / (111320.0 * cos(radians(origin_lat)))
            lon = origin_lon + dlon
            
            # è®¡ç®—æµ·æ‹”
            alt = z + origin_alt
            
            return {'lat': lat, 'lon': lon, 'alt': alt}
        ```
        
        ç¤ºä¾‹ç»“æœï¼š
        - è¾“å…¥ XYZ: (60.0m, 35.0m, 0.0m)
        - è¾“å‡º GPS: (22.5184123Â°N, 113.9012639Â°E, -5.17m)
        
        æ­¥éª¤ 5.3: å‘å¸ƒ GlobalPositionTarget
        ```python
        global_msg = GlobalPositionTarget()
        global_msg.coordinate_frame = GlobalPositionTarget.FRAME_GLOBAL_INT
        global_msg.latitude = lat   # 22.5184123
        global_msg.longitude = lon  # 113.9012639
        global_msg.altitude = alt   # -5.17
        
        # å‘å¸ƒåˆ° MAVROS
        self.global_target_pub.publish(global_msg)
        # è¯é¢˜: setpoint_raw/global
        ```
        
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: MAVROS â†’ é£æ§ (ArduRover)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        MAVROS (mavros_node)
        
        æ­¥éª¤ 6.1: æ¥æ”¶ GlobalPositionTarget
        ```python
        # è®¢é˜… setpoint_raw/global
        # è½¬æ¢ä¸º MAVLink æ¶ˆæ¯
        ```
        
        æ­¥éª¤ 6.2: ç”Ÿæˆ MAVLink æ¶ˆæ¯
        ```
        MAVLink æ¶ˆæ¯: SET_POSITION_TARGET_GLOBAL_INT
        Message ID: 86
        
        å­—æ®µ:
        - coordinate_frame: 6 (FRAME_GLOBAL_INT)
        - lat_int: 225184123 (çº¬åº¦ * 1e7)
        - lon_int: 1139012639 (ç»åº¦ * 1e7)
        - alt: -5.17 (æµ·æ‹”ï¼Œç±³)
        - type_mask: 0x0FF8 (åªä½¿ç”¨ä½ç½®ï¼Œå¿½ç•¥é€Ÿåº¦/åŠ é€Ÿåº¦)
        ```
        
        æ­¥éª¤ 6.3: å‘é€åˆ°é£æ§
        ```
        ä¸²å£/UDP: /dev/ttyACM0 æˆ– udp://192.168.10.1:14550
                         â†“
                    ArduRover é£æ§
        ```
        
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: é£æ§æ‰§è¡Œå¯¼èˆª                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        ArduRover å›ºä»¶
        
        æ­¥éª¤ 7.1: æ¥æ”¶ SET_POSITION_TARGET_GLOBAL_INT
        - è§£æ GPS ç›®æ ‡åæ ‡
        - ä¸å½“å‰ GPS ä½ç½®æ¯”è¾ƒ
        
        æ­¥éª¤ 7.2: è·¯å¾„è§„åˆ’
        - è®¡ç®—èˆªå‘è§’
        - è®¡ç®—è·ç¦»
        - ç”Ÿæˆæ§åˆ¶æŒ‡ä»¤
        
        æ­¥éª¤ 7.3: ç”µæœºæ§åˆ¶
        - æ¨è¿›å™¨è¾“å‡º (PWM)
        - èˆµæœºæ§åˆ¶
        - é€Ÿåº¦è°ƒèŠ‚
        
                              â†“
        ğŸ¯ USV åˆ°è¾¾ç›®æ ‡ç‚¹ï¼
```

---

## ğŸ“Š å…³é”®åæ ‡ç³»è¯´æ˜

### 1ï¸âƒ£ **Area åæ ‡ç³»** (ä»»åŠ¡ç›¸å¯¹åæ ‡)
- **åŸç‚¹**: Area Center (ä»»åŠ¡åŒºåŸŸä¸­å¿ƒ)
- **ç”¨é€”**: XML ä»»åŠ¡æ–‡ä»¶ä¸­çš„åæ ‡
- **ç¤ºä¾‹**: `(10.0, 5.0, 0.0)`

### 2ï¸âƒ£ **Global åæ ‡ç³»** (å…¨å±€ç»å¯¹åæ ‡)
- **åŸç‚¹**: A0 åŸºç«™ (22.5180977Â°N, 113.9007239Â°E)
- **å•ä½**: ç±³ (ENU: ä¸œ-åŒ—-å¤©)
- **ç”¨é€”**: åœ°é¢ç«™å†…éƒ¨è®¡ç®—
- **ç¤ºä¾‹**: `(60.0, 35.0, 0.0)` = Area Center (50, 30, 0) + XML (10, 5, 0)

### 3ï¸âƒ£ **USV Local åæ ‡ç³»** (USV æœ¬åœ°åæ ‡)
- **åŸç‚¹**: A0 åŸºç«™ (é€šè¿‡ Home Position è®¾ç½®)
- **å•ä½**: ç±³ (ENU)
- **ç‰¹ç‚¹**: ä¸ Global åæ ‡ç³»æ•°å€¼ç›¸åŒï¼
- **ç¤ºä¾‹**: `(60.0, 35.0, 0.0)`

### 4ï¸âƒ£ **GPS åæ ‡ç³»** (å…¨å±€å®šä½åæ ‡)
- **åŸç‚¹**: åœ°çƒä¸­å¿ƒ
- **å•ä½**: åº¦ (çº¬åº¦/ç»åº¦/æµ·æ‹”)
- **ç”¨é€”**: é£æ§å¯¼èˆª
- **ç¤ºä¾‹**: `(22.5184123Â°N, 113.9012639Â°E, -5.17m)`

---

## ğŸ”„ å®Œæ•´æ•°æ®æµç¤ºä¾‹

### è¾“å…¥ï¼ˆXML æ–‡ä»¶ï¼‰
```xml
<mission>
  <waypoint id="1" x="10.0" y="5.0" z="0.0" />
</mission>
```

### å¤„ç†æµç¨‹

| æ­¥éª¤ | æ¨¡å— | è¾“å…¥ | è¾“å‡º | è¯´æ˜ |
|------|------|------|------|------|
| 1 | GUI è¯»å– XML | XML æ–‡ä»¶ | `Area (10, 5, 0)` | ç›¸å¯¹åæ ‡ |
| 2 | é›†ç¾¤æ§åˆ¶å™¨ | Area (10, 5, 0) | `Global (60, 35, 0)` | +Area Center (50, 30, 0) |
| 3 | åæ ‡è½¬æ¢ | Global (60, 35, 0) | `Local (60, 35, 0)` | æ•°å€¼ç›¸åŒ |
| 4 | Action å‘é€ | Local (60, 35, 0) | â†’ ç½‘ç»œ â†’ | NavigateToPoint |
| 5 | Action Server | Local (60, 35, 0) | PoseStamped | set_usv_target_position |
| 6 | coord_transform_node | XYZ (60, 35, 0) | `GPS (22.5184Â°N, 113.9013Â°E)` | XYZâ†’GPS è½¬æ¢ |
| 7 | MAVROS | GPSåæ ‡ | MAVLink æ¶ˆæ¯ | SET_POSITION_TARGET_GLOBAL_INT |
| 8 | é£æ§ | MAVLink | ç”µæœºæ§åˆ¶ | å¯¼èˆªæ‰§è¡Œ |

---

## âš™ï¸ å…³é”®é…ç½®

### Area Center è®¾ç½®ï¼ˆåœ°é¢ç«™ï¼‰
```yaml
# gs_bringup/config/gs_params.yaml
main_gui_app:
  ros__parameters:
    area_center_x: 50.0  # ä¸œå‘åç§»
    area_center_y: 30.0  # åŒ—å‘åç§»
    area_center_z: 0.0   # é«˜åº¦åç§»
```

### GPS åŸç‚¹è®¾ç½®ï¼ˆUSVï¼‰
```yaml
# usv_bringup/config/usv_params.yaml
coord_transform_node:
  ros__parameters:
    gps_origin_lat: 22.5180977  # A0åŸºç«™çº¬åº¦
    gps_origin_lon: 113.9007239 # A0åŸºç«™ç»åº¦
    gps_origin_alt: -5.17       # A0åŸºç«™æµ·æ‹”
    enable_coord_transform: true
    use_global_position_target: true
```

### æ§åˆ¶æ¨¡å¼ï¼ˆUSVï¼‰
```yaml
usv_control_node:
  ros__parameters:
    enable_local_control: false  # ç¦ç”¨å±€éƒ¨æ§åˆ¶ï¼Œä½¿ç”¨å…¨å±€GPSæ¨¡å¼
```

---

## ğŸ¯ ä½ çš„ç†è§£éªŒè¯

### âœ… **æ­£ç¡®çš„éƒ¨åˆ†**

1. âœ… **åœ°é¢ç«™æ‰“å¼€ XML æ–‡ä»¶å¹¶åˆ†æ**
   - æ˜¯çš„ï¼GUI è¯»å– XML ä»»åŠ¡æ–‡ä»¶ä¸­çš„èˆªç‚¹åæ ‡

2. âœ… **é›†ç¾¤å‘é€åï¼Œè¿è¡Œ step 1ï¼Œä¸ area åç§»æ•°æ®è®¡ç®—**
   - æ˜¯çš„ï¼é›†ç¾¤æ§åˆ¶å™¨ä½¿ç”¨ `_area_to_global()` å°† Area åæ ‡ + Area Center åç§» = Global åæ ‡

3. âœ… **å°†æ•°æ®é€šè¿‡å¯¼èˆªé€»è¾‘ action æ–¹å¼å‘é€ç»™ usv**
   - æ˜¯çš„ï¼ä½¿ç”¨ `NavigateToPoint` Action å‘é€ç›®æ ‡ç‚¹åˆ° USV

4. âœ… **usv å¯¼èˆªæœåŠ¡å¤„ç†åå†å‘é€ç»™é£æ§ï¼Œå‘é€æ–¹å¼ä¸ºå…¨å±€åæ ‡ goal**
   - æ˜¯çš„ï¼`coord_transform_node` å°† XYZ è½¬æ¢ä¸º GPS åæ ‡ï¼Œé€šè¿‡ `setpoint_raw/global` å‘é€åˆ°é£æ§

### ğŸ“ **è¡¥å……è¯´æ˜**

1. **åæ ‡è½¬æ¢åˆ†ä¸¤æ­¥**ï¼š
   - ç¬¬ä¸€æ­¥ï¼šArea â†’ Global (åœ°é¢ç«™é›†ç¾¤æ§åˆ¶å™¨)
   - ç¬¬äºŒæ­¥ï¼šXYZ â†’ GPS (USV åæ ‡è½¬æ¢èŠ‚ç‚¹)

2. **Global å’Œ Local åæ ‡æ•°å€¼ç›¸åŒ**ï¼š
   - å› ä¸º USV çš„ Home Position è®¾ç½®ä¸º A0 åŸºç«™
   - æ‰€ä»¥ Global åæ ‡ç³»å’Œ Local åæ ‡ç³»åŸç‚¹ç›¸åŒ

3. **é¿éšœåŠŸèƒ½ä¹Ÿèµ°åŒæ ·æµç¨‹**ï¼š
   - é¿éšœèŠ‚ç‚¹ â†’ `avoidance_position` â†’ `coord_transform_node` â†’ GPS â†’ é£æ§

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æŸ¥çœ‹å®Œæ•´æ—¥å¿—é“¾è·¯

```bash
# åœ°é¢ç«™æ—¥å¿—
ros2 topic echo /rosout | grep "Areaâ†’Global\|åæ ‡è½¬æ¢"

# USV æ—¥å¿—
ros2 topic echo /usv_01/rosout | grep "XYZâ†’GPS"

# ç›‘å¬å…¨å±€GPSè¯é¢˜
ros2 topic echo /usv_01/setpoint_raw/global
```

### 2. å‘é€æµ‹è¯•ç›®æ ‡ç‚¹

```bash
# æ¨¡æ‹Ÿåœ°é¢ç«™å‘é€ Area åæ ‡ (10, 5, 0)
# å‡è®¾ Area Center = (50, 30, 0)
# åˆ™ Global åæ ‡ = (60, 35, 0)

ros2 topic pub --once /usv_01/set_usv_target_position \
  geometry_msgs/msg/PoseStamped \
  '{pose: {position: {x: 60.0, y: 35.0, z: 0.0}}}'

# åº”è¯¥åœ¨ setpoint_raw/global çœ‹åˆ° GPS åæ ‡
```

### 3. éªŒè¯ MAVLink æ¶ˆæ¯

```bash
# ç›‘å¬ UDP ç«¯å£ï¼ˆéœ€è¦åœ¨é£æ§ç½‘ç»œä¸­ï¼‰
nc -ul 192.168.10.1 -p 14550 | hexdump -C | grep "86"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `COORDINATE_SYSTEM_DESIGN.md` - åæ ‡ç³»ç»Ÿè®¾è®¡
- `AREA_OFFSET_GUIDE.md` - Area åç§»é‡è®¾ç½®æŒ‡å—
- `ARCHITECTURE_REFACTORING.md` - æ¶æ„é‡æ„è¯´æ˜
- `IMPLEMENTATION_SUMMARY.md` - å®ç°æ€»ç»“

---

## ğŸ‰ æ€»ç»“

**ä½ çš„ç†è§£å®Œå…¨æ­£ç¡®ï¼**å®Œæ•´æµç¨‹å°±æ˜¯ï¼š

```
XML ä»»åŠ¡æ–‡ä»¶ (Areaåæ ‡)
    â†“ (åœ°é¢ç«™è¯»å–)
é›†ç¾¤æ§åˆ¶å™¨ (Area + åç§» = Global)
    â†“ (Actionå‘é€)
USV Action Server (æ¥æ”¶ XYZ)
    â†“ (å‘å¸ƒè¯é¢˜)
coord_transform_node (XYZ â†’ GPS)
    â†“ (MAVLink)
é£æ§ (å¯¼èˆªæ‰§è¡Œ)
```

æ ¸å¿ƒè¦ç‚¹ï¼š
1. âœ… åæ ‡è½¬æ¢åˆ†ä¸¤å±‚ï¼ˆåœ°é¢ç«™ + USVï¼‰
2. âœ… ä½¿ç”¨ Action é€šä¿¡
3. âœ… æœ€ç»ˆå‘é€å…¨å±€ GPS åæ ‡åˆ°é£æ§
4. âœ… æ‰€æœ‰ USV ä½¿ç”¨ç»Ÿä¸€çš„ A0 åŸºç«™åŸç‚¹

---

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-11-14  
**çŠ¶æ€**: âœ… å®Œæ•´è¯´æ˜
